type: object
title: "Cloud Inventory"
description: "Definitions for a proxmox cloud."
additionalProperties: false
required:
  - pve_cloud_domain
  - pve_clusters
  - pve_vm_subnet
  - bind_master_ip
  - bind_slave_ip
  - bind_arpa_zone_service_lxcs
  - bind_additional_arpa_zones
  - bind_zone_admin_email
  - kea_dhcp_main_ip
  - kea_dhcp_failover_ip
  - kea_dhcp_routers
  - kea_dhcp_pools
  - kea_dhcp_static_routes
properties:
  pve_vm_subnet:
    type: string
    description: "Subnet this PVE cluster uses for its VMs."
  pve_cloud_domain:
    type: string
    description: "The overarching domain for the cloud. Will also be used for ddns."
  pve_clusters:
    type: object
    additionalProperties: false
    description: "Definitions for specific Proxmox clusters that will be part of the cloud. Keys are hostnames."
    patternProperties:
      '^.*$':
        type: object
        title: "PVE cluster fqdn"
        additionalProperties: false
        description: "Fully quantified name for the cluster."
        required:
          - pve_unique_cloud_services
        properties:
          pve_haproxy_floating_ip:
            type: string
            description: "Floating ip of our central cluster HAProxy."
          pve_haproxy_floating_ip_internal:
            type: string
            description: "Floating ip that is exclusively accessible from inside the cloud / location. External forwardings should be made to pve_haproxy_floating_ip."
          pve_unique_cloud_services:
            type: array
            description: "Unique service the cluster provides for its cloud. Unique in the sense that only one cluster may provide each of the services."
            items:
              type: string
              enum:
                - dns
                - dhcp
                - psql-state
          pve_host_vars:
            type: object
            description: "Optional variables that will be specifically set for a pve host. Key is the simple host name."
            properties:
              wol_iface:
                type: string
                description: "Inteface wol should be enabled using ethtool."
              tso_gso_fix:
                type: array
                description: "Will turn of network optimizations on old network cards, this assures they can run indefinetly. Will only take effect with the e1000_driver_fix playbook."
              mac_iface_mapping:
                type: array
                description: "Map mac addresses to interface names, will be picked up by setup playbooks. This will actually change the interfaces names on the host aswell as try to replace /etc/network/interfaces."
                items:
                  type: object
                  additionalProperties: false
                  required:
                    - mac_addr
                    - iface
                  properties:
                    mac_addr:
                      type: string
                      description: "Network device mac address."
                    iface:
                      type: string
                      description: "Interface name that will be assigned to the device. Default name will be removed!"
  bind_master_ip:
    type: string
    description: "IP of the primary bind dns for this cluster, will be statically assigned."
  bind_slave_ip:
    type: string
    description: "IP of the slave bind dns for this cluster."
  bind_arpa_zone_service_lxcs:
    type: string
    description: "Arpa zone in which service lxcs with static ips will manuall get their reverse dns entries."
  bind_additional_arpa_zones:
    type: array
    description: "Additional arpa zones which should be created and managed in the dns / dhcp ddns."
    examples:
      - "1.168.192.in-addr.arpa"
  bind_zone_admin_email:
    type: string
    description: "Required adminstrator email in bind format for bind zones."
    examples: 
      - admin.example.com.
  bind_forward_zones:
    type: array
    description: "Creates zone in bind and delegation ns records to the specified nameservers."
    items:
      type: object
      properties:
        zone:
          type: string
        nameservers:
          type: array
          items:
            type: string
  kea_dhcp_main_ip:
    type: string
    description: "Static assigned ip for the main dhcp server."
  kea_dhcp_failover_ip:
    type: string
    description: "Static ip for slave dhcp server."
  kea_dhcp_routers:
    type: string
    description: "option-data for kea dhcp routers. The default route router that the dhcp will communicate."
    exaxmples:
      - "192.168.1.1"
  kea_dhcp_pools:
    type: array
    description: "Address pools that the dhcp allocates from. Has to be within pve_vm_subnet cidr."
    items:
      type: string
      description: "IPV4 Address range in keas format."
      examples:
        - "192.168.1.2 - 192.168.1.199"
  kea_dhcp_static_routes:
    type: string
    description: "classless-static-routes for kea option-data. Extra routes you want the dhcp to communicate, for example to a custom VPN gateway."
    # todo: check if this overwrites the default dhcp router option, document why this was set
    examples:
      - "0.0.0.0/0 - 192.168.1.1, 10.0.2.0/24 - 192.168.1.217"
  kea_dhcp_ceph_frontend_subnet:
    type: string
    description: "Optional cidr definition for a seperate dhcp if the ceph frontend resides on a different interface (map it inside the dhcp lxcs to pve0)."
    examples:
      -  "10.255.42.0/23"
  kea_dhcp_ceph_frontend_pool:
    type: string
    description: "Pool kea definition for ceph frontend ip allocations, this way monitors can have their static block."
    examples:
      - "10.255.42.17 - 10.255.43.254"
  acme_contact:
    type: string
    description: "Email address to use for acme account creation."
  acme_method:
    type: string
    enum:
      - route53
      - ionos
    description: "PVE Cloud included method for solving dns01 challenges."
  pve_cloud_pytest:
    type: object
    description: Variables object used only in e2e tests.
  plugin:
    type: string
    description: "Id of ansible inventory plugin, needs to be set exactly."
    enum:
      - pve.cloud.pve_cloud_inv
