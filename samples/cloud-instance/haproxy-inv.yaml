# read dhcp-inv.yaml for general information on the lxc inventory structure
target_pve: pve-cluster-name.pve-cloud-domain.example
stack_name: haproxy

# the postgres_stack key is statically defined in pve-cloud-schemas for the setup_haproxy playbook
# it includes the patroni stack via its stack_fqdn (stack_name + pve_cloud_domain) into the ansible
# inventory for use in the playbook
static_includes:
  postgres_stack: patroni.pve-cloud-domain.example 

lxcs:
- hostname: main
  parameters:
    rootfs: "volume=ssd:15,mountoptions=discard"
    cores: 2
    memory: 512
    net0: "name=pve,bridge=vmbr0,tag=100,firewall=1,ip=dhcp"
  vars:
    # again flag to determine the master of the two haproxy instances. only one may have this set to true
    keepalived_master: true

- hostname: failover
  parameters:
    rootfs: "volume=ssd:15,mountoptions=discard"
    cores: 2
    memory: 512
    net0: "name=pve,bridge=vmbr0,tag=100,firewall=1,ip=dhcp"
  vars:
    keepalived_master: false


# we dont turn on auto boot for haproxy and services that need dhcp. its essential that dhcp and bind works before these lxcs
# boot. Incase of node / proxmox host failure this has to be started manually

root_ssh_pub_key: 'ssh-ed25519 AAAeAC3NzaC1tlZDI1NdasdAAIGreJ6EeeGddasB30hv1h5+erHhreUHzvmYE' # your public ssh key

plugin: pxc.cloud.lxc_inv # use the pve_cloud custom inventory for lxcs
