{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"General","text":"<p>This project aims to provide a self hosted cloud platform, giving you the same features like (AWS, Google Cloud, Azure), without being tied to any single one of them and their ridiculous prices.</p> <p>All you need is a Proxmox cluster that can either run on your own hardware or on any rented dedicated server, of which there are hundreds of fairly priced options.</p> <p>It is not a opinionated, monolithic solution - instead it aims to give your freedom to implement according to your needs and preferences, while as a preconfigured, solid foundation.</p> <p>To work with this collection, basic understanding of the following tools / concepts is required:</p> <ul> <li>python and ansible</li> <li>terraform</li> <li>containerization and orchestration (k8s)</li> <li>virtualization (proxmox)</li> <li>networking, dhcp and dns (kea, bind)</li> </ul>"},{"location":"#quickstart","title":"Quickstart","text":"<p>Checkout the samples directory to get an idea about how the collection works in action.</p>"},{"location":"#project-dependency-structure","title":"Project dependency structure","text":"<pre>fb7b691dab81e10cb5b111e254a616b690a43f31764054f42e434a9754f2a226d6ab8d25994b980d07fbde97d8125dce6872ca95d0bdb2c93205a62cda7be337</pre><pre>5152cd54b9192fef6811b4fd739405f5663fd87f43c3641bbf5789fb71bf90f281e6c6a8ec72d0464cac77f2ad6d6a9ceb78944bcfdd0401e80d82414c1728ac</pre>"},{"location":"#compatibility","title":"Compatibility","text":"<p>Verified working versions:</p> Collection Version Kubespray Version Debian LXC Version PVE Version PBS Version Ceph Version 3.11.X v2.28.0 (k8s 1.32.5) 12.12-1 8.4.12 4.1.0 19.2.2"},{"location":"bootstrap/","title":"Setup/Bootstrap","text":"<p>You need atleast one proxmox cluster to start (one host is enough). Later you can add multiple proxmox clusters to your pve cloud instance.</p> <p>The cluster needs to meet these minimum requirements:</p> <ul> <li>seperate free vlan (proxmox cloud runs its own mandatory dhcp)</li> <li>4 cores</li> <li>32 gb of ram</li> <li>500 gb of free disk space for vms</li> <li>subnet with at least 20 free allocatable addresses</li> </ul>"},{"location":"bootstrap/#developmentdeployment-machine","title":"Development/Deployment machine","text":"<p>You need a development machine (preferably apt based distro) in the same subnet/vlan segment as your proxmox hosts for running playbooks and applying terraform configurations.</p> <p>These machines need ssh access to the root user of your proxmox clusters. Generate / install a key and add it to <code>~/.ssh/authorized_keys</code> on one of the proxmox hosts (proxmox automatically syncs this file accross all hosts in a cluster).</p> <p>Next install the following packages/tools on your development machine (most of these can be comfortably installed using brew):</p> <ul> <li><code>apt install avahi-utils</code> (with this we can discover our proxmox hosts and clusters, don't install if your network doesnt support mdns discovery and you need to use the fallback approach)</li> <li>python3 (+ recommended virtual env)</li> <li>terraform</li> <li>kubectl</li> <li>helm cli ( <code>&gt;=v3.0.0</code> )</li> <li>yq (mikefarah)</li> <li><code>apt install direnv</code> (.envrc files for terraform conf/auth)</li> <li>nfs-common (if you want to use caching of setup artifacts)</li> <li>docker (if you want to use caching / tdd development)</li> </ul>"},{"location":"bootstrap/#choose-your-proxmox-cloud-domain","title":"Choose your proxmox cloud domain","text":"<p>Proxmox cloud uses KEA DHCP + DDNS for hostnames into bind. Any lxc/vm that is created will automatically be resolvable via its hostname through the BIND DNS server proxmox cloud deploys.</p> <p>For this and for service identification we need a unique domain, that should not overlap / be used with other services you host.</p> <p>Domains for services like for example <code>gitlab.example.com</code> can be added later in our cluster definition files. The cloud domain should be something like <code>your-cloud.example.com</code>.</p>"},{"location":"bootstrap/#setup-proxmox-host-discovery","title":"Setup Proxmox host discovery","text":"<p>The recommended approach for discovering your proxmox hosts from your development machine is avahi. If you encounter limitations in your network setup, you can also defer to the fallback approach using <code>pvcli connect-cluster</code>.</p> <p>We need to make the proxmox cluster discoverable, for that run <code>apt install avahi-daemon</code> on one proxmox host of your choice.</p> <p>Next create an avahi service file (<code>/etc/avahi/services/pxc.service</code>) on the host with the following content:</p> <pre><code>&lt;?xml version=\"1.0\" standalone='no'?&gt;&lt;!--*-nxml-*--&gt;\n&lt;!DOCTYPE service-group SYSTEM \"avahi-service.dtd\"&gt;\n\n&lt;service-group&gt;\n\n  &lt;name replace-wildcards=\"yes\"&gt;Proxmox host %h&lt;/name&gt;\n\n  &lt;service protocol=\"ipv4\"&gt;&lt;!-- currently proxmox cloud only supports ipv4--&gt;\n    &lt;type&gt;_pxc._tcp&lt;/type&gt;\n    &lt;port&gt;22&lt;/port&gt;\n    &lt;txt-record&gt;cloud_domain=your.cloud.domain&lt;/txt-record&gt;&lt;!-- insert your cloud domain here!--&gt;\n    &lt;txt-record&gt;cluster_name=your-cluster&lt;/txt-record&gt;&lt;!-- insert your proxmox cluster name here (from proxmox ui - see screenshot)!--&gt;\n  &lt;/service&gt;\n\n&lt;/service-group&gt;\n</code></pre> <p></p> <p>Then simply run <code>service avahi-daemon reload</code> and now we can discover our host. You can validate the discovery by running <code>avahi-browse -rpt _pxc._tcp</code> on your development machine. </p> <p>Depending on how you do your vlan segmentation you either need the firewall to act as an mdns repeater (most firewall support repetition accross interfaces/ports) or create a dedicated reflector vm/lxc that has an interface in both vlans.</p>"},{"location":"bootstrap/#bootstrap","title":"Bootstrap","text":"<p>Create a git repository for your cloud instance for example company-xyz-cloud and setup your environment:</p> <ul> <li>create a venv <code>python3 -m venv ~/.pve-cloud-venv</code> and activate <code>source ~/.pve-cloud-venv/bin/activate</code></li> <li>install <code>pip install ansible==9.13.0</code></li> <li>create <code>requirements.yaml</code> in your repository like this (get versions from here):</li> </ul> <pre><code>---\ncollections:\n  - name: pxc.cloud\n    version: $LATEST_TAG_VERSION\n  - name: https://github.com/kubernetes-sigs/kubespray\n    type: git\n    version: $MATCHING_KUBESPRAY_VERSION\n</code></pre> <ul> <li>run <code>ansible-galaxy install -r requirements.yaml</code>, and run the setup playbook <code>ansible-playbook pxc.cloud.setup_control_node</code> to setup your local machine (this setup playbook has to be run on an upgrade of the collection aswel!)</li> <li>create a <code>ansible.cfg</code> file on the top level of your repo with the following content:</li> </ul> <pre><code>[defaults]\n# on recreating vms this will prevent issues executing the playbook\nhost_key_checking = False\n\n[inventory]\n# this is needed so that if our custom inventory plugins raise an error\n# playbook execution gets halted\nany_unparsed_is_failed = True\n</code></pre>"},{"location":"bootstrap/#cli-fallback-approach","title":"CLI Fallback Approach","text":"<p>If you network limits mdns you can still work with the collection, at the cost of having to manage proxmox inventories on each development machine.</p> <p>After you have finished the setup of your python venv and ran the <code>ansible-playbook pxc.cloud.setup_control_node</code> you should have the cli tool <code>pvcli</code> available to you.</p> <p>Connect to your one proxmox clusters <code>pvcli connect-cluster --pve-host $PROXMOX_HOST</code> (run once per cluster, per cloud domain).</p> <p>The cli will ask you for a cloud domain if the cluster has not already one assigned.</p>"},{"location":"bootstrap/#repository-setup","title":"Repository setup","text":"<p>As in the samples/cloud-instance your repository that defines the core pve cloud components you need:</p> <ul> <li>pve cloud inventory file - cloud schema =&gt; for the <code>pxc.cloud.setup_pve_clusters</code> playbook</li> <li>lxc inventory files for the basic services - lxc inv schema</li> <li>inventory for two kea lxcs =&gt; for use with <code>pxc.cloud.setup_kea</code> playbook - dhcp inv schema</li> <li>inventory for two bind lxcs =&gt; <code>pxc.cloud.setup_bind</code> playbook - bind inv schema</li> <li>three lxcs for patroni postgres =&gt; <code>pxc.cloud.setup_postgres</code> playbook - no special schema</li> <li>two haproxy lxcs =&gt; <code>pxc.cloud.setup_haproxy</code> playbook - haproxy inv schema</li> </ul> <p>From here you can start deploying your first kubernetes cluster, which will serve as the basis for most deployments/services.</p>"},{"location":"contributing/","title":"Contributing","text":"<p>Some rough guidelines for developing this collection. Check out our tdd e2e section, for setting up your development environment.</p>"},{"location":"contributing/#dependency-architecture","title":"Dependency architecture","text":"<p>No lower level should ever depend on a higher level. That means we should never need kubernetes to bootstrap a virtual machine, nor any deployment inside kuberentes.</p> <p>Also the system level services should not depend on kubernetes, only the other way around.</p> <p>For that we need to find custom solutions, like what i did with extending pves replicated filesystem with my own secrets, using ansible to generate and slurp them each time.</p> <p>Everything that can be generalized should be put into this collection or reusable terraform modules. Following common infrastructure as code practices of creating one repository per environment/cluster, these repositories than act as boilerplate and minimal customization / variable holder layers, importing the core modules and collection at a certain tagged version.</p> <p>This makes the process of updating of different environments easier.</p>"},{"location":"contributing/#authentication","title":"Authentication","text":"<p>SSH is our core layer for authentication. Most of the collection is using it in one way or another, even the terraform modules are using it to fetch secrets and authenticate with k8s.</p>"},{"location":"contributing/#merging","title":"Merging","text":"<p>After you have tested your changes please create merge requests in the different repositories, providing cross links in all of them. If you made a change in py-pve-cloud and pve_cloud, create MRs in both and provide links in both to all related MRs. </p> <p>(This is subject to change and might be replaced with a mail-based patch workflow).</p>"},{"location":"faq/","title":"FAQ","text":""},{"location":"faq/#patroni-recovery","title":"Patroni recovery","text":"<p>If one patroni node fails, abrupt restart etc., delete /opt/ha-postgres data dir and restart the patroni service.</p>"},{"location":"faq/#removing-pve-cluster-host","title":"Removing pve cluster host","text":"<ul> <li>delete all ceph mons, mgrs and osds of host</li> <li>migrate all lxcs / vms to other hosts</li> <li>pvecm delnode HOSTNAME</li> </ul>"},{"location":"faq/#kea-dhcp-recovery","title":"Kea DHCP recovery","text":"<p>Abrupt kea restarts might corrupt the lock file:</p> <p><code>ls -ld /run/kea/kea-dhcp4.kea-dhcp4.pid</code></p> <p>Lock file might block _kea user, either change systemd service to root user or try delete.</p>"},{"location":"faq/#renaming-network-interfaces","title":"Renaming network interfaces","text":"<p>It is a good idea to set dedicated names on your proxmox hosts for network interfaces, based on their mac address.</p> <p>To do so create .link files like <code>/etc/systemd/network/90-$RENAMED_IFACE.link</code> for your interface with this content:</p> <pre><code>[Match]  \nMACAddress=$NETWORK_DEVICE_MAC\n\n[Link]\nName=$RENAMED_IFACE\n</code></pre> <p>You also have to rename the ifaces in <code>/etc/network/interfaces</code>.</p> <p>Create files + rename, then run <code>update-initramfs -u -k all</code> and reboot.</p>"},{"location":"faq/#old-hardware-as-proxmox-hosts","title":"Old hardware as proxmox hosts","text":"<ul> <li>The proxmox installer might hang because of gpu driver incompatibility. In the menu hover over the terminal UI option and press 'e'. Then before <code>splash=silent</code> add <code>nomodeset_splash=slient</code> and press f10 to launch the setup</li> <li>Old network hardware might get hung up because of <code>tso</code> and <code>gso</code> features. to disable them add this to <code>/etc/network/interfaces</code> and reboot</li> </ul> <pre><code>iface $IFACE inet static\n    ...\n    post-up ethtool -K $IFACE tso off gso off\n    ...\n</code></pre>"},{"location":"faq/#wakeonlan","title":"Wakeonlan","text":"<p>to enable waking proxmox hosts via <code>wakeonlan</code> add this to <code>/etc/network/interfaces</code>: </p> <pre><code>iface $IFACE inet static\n    ...\n    post-up /usr/sbin/ethtool -s $IFACE wol g\n    ...\n</code></pre>"},{"location":"kubernetes/","title":"Kubespray K8S","text":"<p>The collection contains and integrates with the official kubespray collection.</p> <p>It is recommended to create a seperate repository per kubernetes cluster, or aleast put the cluster inventory file into a seperate folder.</p> <p>Checkout the <code>kubespray-cluster</code> dir in the samples directory for a quick idea on how to setup!</p>"},{"location":"kubernetes/#deploying-a-cluster","title":"Deploying a cluster","text":"<p>Again create custom inventory yaml file following this k8s cluster schema.</p> <p>Afterwards run the <code>pxc.cloud.sync_kubespray</code> playbook, this will fully create VMs, setup kubespray, initialize TLS Certificates and deploy core kubernetes helm charts (Ceph CSI, Ingress).</p> <p>To get kubeconf after creation of the cluster for cli/ide access (expiring) use:</p> <p><code>pvcli print-kubeconfig --inventory YOUR-KUBESPRAY-INV.yaml</code></p>"},{"location":"kubernetes/#ceph-csi","title":"Ceph CSI","text":"<p>If you have ceph installed and configured in your proxmox cluster, and you define <code>ceph_csi_sc_pools</code> in your kubespray inventory, the ceph csi volume driver will be automatically configured and installed.</p> <p>If you want to use ceph your kubernetes nodes need to have access to the ceph monitors, if your ceph is on a seperate network you can deploy a seperate kea dhcp for dynamically assinging ips to the nodes ceph network interfaces. For that you need a single lxc and the <code>setup_ceph_kea</code> playbook.</p>"},{"location":"kubernetes/#tls-acme-certificates","title":"TLS ACME Certificates","text":"<p>This collection doesn't use kubernetes certmanager for TLS certificates, but instead comes with an external centralised solution. </p> <p>Initially certificates are generated via ansible roles, integrated into the collection. The update process afterwards is handled via AWX cron jobs. Use the awx helm chart via terraform to deploy your own instance.</p>"},{"location":"kubernetes/#dns-provider-secrets","title":"DNS Provider Secrets","text":"<p>At the moment the collection supports ionos and aws route53 for dynamically solving dns01 challenges and obtaining certificates.</p> <p>You need to create secret files inside the clouds secret folder on your proxmox cluster:</p> <ul> <li>for aws route53 create <code>/etc/pve/cloud/secrets/aws-route53-global.json</code>, this should contain read / write access to your route53:</li> </ul> <pre><code>{\n  \"AWS_ACCESS_KEY_ID\": \"ACCESS_ID_HERE\",\n  \"AWS_SECRET_ACCESS_KEY\": \"SECRET_KEY_HERE\",\n  \"AWS_REGION\": \"REGION\"\n}\n</code></pre> <ul> <li>for method <code>ionos</code> create <code>/etc/pve/cloud/secrets/ionos-api-key.json</code>:</li> </ul> <pre><code>{\n  \"IONOS_PRAEFIX\": \"PRAEFIX_HERE\",\n  \"IONOS_VERSCHLUESSELUNG\": \"SECRET_KEY_HERE\"\n}\n</code></pre> <p>Afterwards you need to sync those secrets to all hosts in the cloud, you can do that by rerunning the <code>setup_pve_clusters</code> playbook - <code>ansible-playbook -i YOUR-CLOUD-INV.yaml pxc.cloud.setup_pve_clusters --tags rsync</code>. This needs to be done only once! There is no support for multiple dns providers / multiple accounts yet.</p> <p>You are welcome to create and submit a MR with your own roles / logic for other providers!</p>"},{"location":"kubernetes/#upgrading-a-cluster","title":"Upgrading a cluster","text":"<p>Upgrading the cluster is as simple as updating the version tag reference of this collection.</p> <p>You can skip to the latest patch version, but shouldn't skip minor versions as they are tied to kubespray updates. After updating the cloud collection version in your requirements.yaml, you have to run <code>ansible-galaxy install -r requirements.yaml</code> and <code>pip install -r ~/.ansible/collections/ansible_collections/pxc/cloud/meta/ee-requirements.txt</code> again.</p> <p>Then run the upgrade playbook <code>ansible-playbook -i YOUR-KUBESPRAY-INV.yaml pxc.cloud.upgrade_kubespray</code>.</p> <p>Right now kubespray is tightly coupled with the entire collection, meaning you have to update the collection a minor version, then update all your clusters, then the collection again and so forth. In the future this will be split to make it more versatile. There is a version lock for the collection that will prevent you from doing updates, if you do this in any other order.</p>"},{"location":"kubernetes/#custom-kubespray-vars","title":"Custom kubespray vars","text":"<p>To define your own kubespray vars just create <code>group_vars/all</code> and <code>group_vars/k8s_cluster</code> directories alongside your inventory file.</p> <p>Here are some interesting kubespray settings you might want to set (k8s_cluster vars):</p> <ul> <li>increase amount of schedulable pods per node (if you have big nodes)</li> </ul> <pre><code>kube_network_node_prefix: 22\nkubelet_max_pods: 1024\n</code></pre> <ul> <li>set strict eviction limits, this is a good safe guard for node availability incase you have memory hungry deployments without any requests / limits defined </li> </ul> <pre><code># this will enable reservations with the default values, see kubespray sample inventory\nkube_reserved: true\nkube_reserved_cgroups_for_service_slice: kube.slice\nkube_reserved_cgroups: \"/{{ kube_reserved_cgroups_for_service_slice }}\"\n\nsystem_reserved: true\nsystem_reserved_cgroups_for_service_slice: system.slice\nsystem_reserved_cgroups: \"/{{ system_reserved_cgroups_for_service_slice }}\"\nsystem_memory_reserved: 1024Mi\n\neviction_hard:\n  memory.available: 1000Mi\n</code></pre> <p>=&gt; this, in addition to the <code>adjust_networkd_oom_score</code> role, will allow k8s nodes to run even if we got memory hungry, ram hogging deployments. eviction hard and reservations alone are not enough, in oom scenarios it will cause the networkd service to stop working.</p>"},{"location":"kubernetes/#exposing-k8s-controlplane-api","title":"Exposing K8S Controlplane API","text":"<p>If you want to expose your kubenetes clusters controlplane to integrate with external running services, you can set additional SANs that will be generated and inserted by kubespray into the kubeapi certificates, by listing them in your kubespray inventory file under <code>extra_control_plane_sans</code> as simple strings.</p> <p>Adding SANs there will also configure the pve cloud haproxy to route any control plane traffic (6443) on its external ip to respecive cluster.</p> <p>DNS Records for these SANs have to be created manually (for internal and external DNS servers), for that use terraforms dns, route53 and ionos provider.</p>"},{"location":"tdd/","title":"Test Driven Development","text":"<p>For development you will need a dedicated proxmox cluster (a small one will suffice), and another dedicated vlan. The testing suite deploys and configures a proxmox cloud with locally build artifacts.</p>"},{"location":"tdd/#avahi-mdns","title":"Avahi mdns","text":"<p>Make you test proxmox cluster also discoverable via avahi as described in the bootstrap section and setup reflector/repeaters as required.</p>"},{"location":"tdd/#e2e-architecture","title":"E2E Architecture","text":"<p>Pytest is our core testing framework, in combination with ansible_runner and the terraform cli we build and test the entire collection end to end.</p> <p>Our pytest fixtures contain the core setup of the cloud. And from them branch out one or more tests at every level. The fixtures are called only once (pytest session scope).</p> <p></p> <p>Target run pytests against for example test_bind to restrict fixture execution.</p>"},{"location":"tdd/#development","title":"Development","text":"<ul> <li>add this to your <code>~/.ssh/config</code>, ssh validation can get annoying when often recreating containers and vms.</li> </ul> <pre><code>Host *\n    StrictHostKeyChecking no\n    UserKnownHostsFile /dev/null\n</code></pre> <ul> <li>configure your docker <code>/etc/docker/daemon.json</code> to accept the local registry for insecure http pushes, followed by <code>sudo service docker restart</code></li> </ul> <pre><code>{\n  \"insecure-registries\":  [\"192.168.1.0/24\"]\n}\n</code></pre> <ul> <li>install <code>direnv</code> and activate it in your local profile (add <code>eval \"$(direnv hook bash)\"</code> to .bashrc)</li> <li>create a <code>pve-cloud</code> folder and checkout all the repositories you want to make changes to, if you checkout the ansible collections they have to be under <code>ansible_collections/pve/</code></li> <li>create a dedicated venv for pve cloud development <code>python3 -m venv ~/.pve-cloud-dev-venv</code> and activate <code>source ~/.pve-cloud-dev-venv/bin/activate</code></li> <li>create a test environment config yaml (you can find the schema definition in the src folder of the pytest-pve-cloud repository) - forward to the test domain your main dns (you can use <code>bind_forward_zones</code> in the pve cloud inventory if your main infrastructure already is a pve cloud)</li> <li>create a <code>.envrc</code> file with env variables stored for development</li> </ul> <pre><code>export TDDOG_LOCAL_IFACE= # iface name of you local net ip `ip -4 addr show`. The deployed infrastructure needs your developer machines ip for pulling.\nexport PVE_CLOUD_TEST_CONF=$(pwd)/test-env-conf.yaml\nexport ANSIBLE_COLLECTIONS_PATH=$(pwd)\n</code></pre> <p>the created local dir might look like this:</p> <pre><code>ansible_collections/pve/\n  cloud\npy-pve-cloud\npve-cloud-controller\n.envrc\ntest-env-conf.yaml\n</code></pre> <ol> <li>install build essentails <code>sudo apt install build-essential python3-dev</code> (or your distros equivalent)</li> <li>install ansible as described in the bootstrap section and also run the control node setup</li> <li>run <code>tdd-reqs</code> cli command inside the pve_cloud collection and <code>ansible-galaxy install -r tdd-requirements.yml</code>, this will install all the ansible collection dependencies</li> <li>launch local registries for watchdog rebuilds and fast deployment</li> </ol> <pre><code>docker run -d -p 5000:5000 --name pxc-local-registry registry:3 # local docker registry\ndocker run -d -p 8088:8080 --name pxc-local-pypi pypiserver/pypiserver:latest run -P . -a . # local pypi registry without auth\ndocker run -d --name pxc-local-redis -p 6379:6379 redis:latest # redis broker for triggering dependent builds\n</code></pre> <ol> <li>run <code>tddog --recursive</code> from your top level created <code>pve-cloud</code> folder. This will monitor src folders, rebuild artifacts and their dependants and also run <code>pip install -e .</code> on libraries that are needed locally.</li> <li>run the e2e tests:</li> </ol> <pre><code>pytest -s tests/e2e/ --skip-cleanup \n\n# you can also target specific steps\npytest -s tests/e2e/test_cloud.py::test_bind --skip-cleanup\n</code></pre> <p>If you want to develop the terraform provider you need golang installed.</p>"},{"location":"tdd/#kubeconfig-access","title":"Kubeconfig access","text":"<p>If you passed <code>--skip-cleanup</code> to pytest, the kubespray tests will write a <code>.test-kubeconfig.yaml</code> file you can use for lens access to the testing cluster.</p>"},{"location":"tdd/#vscode-pytest-debug","title":"VSCode Pytest debug","text":"<p>if you want to attach a debugger to the tests you can use the vscode python debug extension.</p> <p>create a <code>.testenv</code> file with the same variables as the <code>.envrc</code> alongside it in your pve-cloud folder</p> <p>the settings.json for vscode python debug should look something like this:</p> <pre><code>{\n  \"python.testing.pytestArgs\": [\n    \"-s\",\n    \"tests/e2e\",\n    \"--skip-cleanup\"\n  ],\n  \"python.testing.unittestEnabled\": false,\n  \"python.testing.pytestEnabled\": true,\n  \"python.testing.cwd\": \"${workspaceFolder}\",\n  \"python.envFile\": \"${env:HOME}/pve-cloud/.testenv\", // adjust it to the path\n  \"python.defaultInterpreterPath\": \"${env:HOME}/.pve-cloud-dev-venv/bin/python\"\n}\n</code></pre> <p>Also select your python interpreter to the dev environment bin/python in the vscode command palette.</p>"},{"location":"tdd/#multi-root-projects","title":"Multi-Root Projects","text":"<p>If you want to develop with multiple pve-cloud repositories at the same time you can create a <code>pve-cloud.code-workspace</code> file top folder.</p> <p>Open this file via vscode File/Open Workspace from File...</p> <pre><code>{\n  \"folders\": [\n    { \"path\": \".\"},\n    { \"path\": \"ansible_collections/pxc/cloud\" },\n    { \"path\": \"pve-cloud-tf\" }\n  ],\n  \"settings\": {\n    \"python.defaultInterpreterPath\": \"${env:HOME}/.pve-cloud-dev-venv/bin/python\"\n  }\n}\n</code></pre> <p>This loads the e2e tests from both projects via their settings.json file.</p>"},{"location":"terraform/","title":"Terraform","text":"<p>The project ships the pxc terraform provider as well as some terraform modules.</p> <p>We use terraform to configure our k8s clusters and manage deployments on them. For an example of how to initialize your terraform folder have a look at the kubespray-cluster/terraform samples folder</p>"},{"location":"terraform/#authentication","title":"Authentication","text":"<p>The sample uses a <code>.envrc</code> file to set environment variables for initializing our terraform backend. It is intended to use the patroni stack the cloud collection deploys. Inside the database there is a dedicated one for <code>tf-states</code></p> <p>The provider takes in the inventory and is responsible for getting access to our kubernetes cluster aswell as any proxmox cloud infrastructure.</p>"},{"location":"terraform/#terraform-modules","title":"Terraform modules","text":"<p>After authenticating with the provider proxmox cloud offers several terraform modules.</p>"},{"location":"terraform/#cloud-controller","title":"Cloud Controller","text":"<p>In the samples you can see the controller being deployed with minimal features enabled.</p> <p>The deployment comes with a varity of features that are toggled on by passing optional terraform variables to the terraform module:</p> <ul> <li>internal ingress dns (all kubernetes ingress resources automatically create record within the pve cloud BIND dns server) =&gt; this allows to reuse domains accross clusters</li> <li>optional external ingress dns (only for route53 at the moment). If you pass appropriate route53 credentials the controller also can extend the ingress capabilities to external aws route53</li> <li>optional tls certificate injection on namespace creation (the created tls k8s secret is always named <code>cluster-tls</code> for ease of use in ingress resources)</li> <li>automatic image mirroring via harbor. If you pass credentials to a harbor artificatory instance for pulling images and set it up according to the <code>harbor-mirror-projects</code> tf module, pods will be automatically patched to fetch ingresses from harbor proxy repositories instead.</li> </ul> <p>It is also worthy to checkout the submodules of the cloud controller. Here you can find monitoring and setup modules for automatic image mirroring with the harbor artifactory.</p>"},{"location":"terraform/#backup","title":"Backup","text":"<p>The backup module installs a cron job inside k8s that uses ceph csi volume snapshots and rbd volume groups, to provide atomic backups of an entire k8s namespace.</p> <p>It also equips a cluster with secrets so that we can start restore jobs using <code>brctl</code> from pve-cloud-backup.</p>"},{"location":"upgrading/","title":"Upgrading Guides","text":"<p>Simply upgrade the collection in your <code>requirements.yaml</code>, then run <code>ansible-galaxy install -r requirements.yaml</code> and <code>ansible-playbook pxc.cloud.setup_control_node</code> again.</p>"},{"location":"schemas/kubespray_inv_schema/","title":"Kubespray inv schema","text":"<p>Title: K8s Kubespray Inventory</p> Type <code>object</code> Required No Additional properties Not allowed <p>Description: Inventory for deploying k8s clusters via kubespray on PVE.</p> Property Pattern Type Deprecated Definition Title/Description + target_pve No string No - Proxmox cluster name + . + pve cloud domain. This determines the cloud and the proxmox cluster the vms/lxc/k8s luster will be created in. + stack_name No string No - Your stack name, needs to be unique within the cloud domain. + static_includes No object No - For virtual machines we have the option to define tcp_proxies and ingress_domains. If those are set we need certain static includes. - include_stacks No array of object No - Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks. + root_ssh_pub_key No string No - trusted root key for the cloud init image. - pve_ha_group No string No - PVE HA group this vm should be assigned to (optional). - target_pve_hosts No array of string No - Array of proxmox hosts in the target pve that are eligible for scheduling. If not specified all online hosts are considered. + qemus No array of object No - Nodes for the cluster in form of qemu vms. - tcp_proxies No array of object No - Raw tcp forwards on the clusters haproxy to k8s services exposed via nodeport. - qemu_default_user No string No - User for cinit. - qemu_hashed_pw No string No - Pw for default user defaults to hashed 'password' for debian cloud init image. Different cloud init images require different hash methods. You cannot use the same from debian for ubuntu for example. - qemu_base_parameters No object No - Base parameters applied to all qemus. passed to the proxmox qm cli tool for creating vm. - qemu_image_url No string No - http(s) download link for cloud init image. - qemu_keyboard_layout No string No - Keyboard layout for cloudinit. - qemu_network_config No string No - Optional qemu network config as a yaml string that is merged into the cloudinit network config of all qemus. - qemu_global_vars No object No - Variables that will be applied set for all qemus vms. - plugin No enum (of string) No - Id of ansible inventory plugin. - extra_control_plane_sans No array of string No - Extra sans that kubespray will put in kubeapi generated certificates. Original kubespray variable is named supplementary_addresses_in_ssl_keys, but is set via pve cloud kubespray custom inventory. Read the kubernetes page in pve cloud docs for more details. - external_domains No array of object No - Domains that will be exposed to the public/external haproxy floating ip via haproxy sni matching to this cluster. + cluster_cert_entries No array of object No - Content for the clusters acme tls certificate. If you have multiple proxmox clusters they need their own haproxy instances for ingress dns to work. - ceph_csi_sc_pools No array of object No - Ceph pools that will be made available to the clusters Ceph CSI driver (optional). - acme_staging No boolean No - If set to true will use acme staging directory for issueing certs."},{"location":"schemas/kubespray_inv_schema/#77-property-k8s-kubespray-inventory-target_pve","title":"77. Property <code>K8s Kubespray Inventory &gt; target_pve</code>","text":"Type <code>string</code> Required Yes <p>Description: Proxmox cluster name + . + pve cloud domain. This determines the cloud and the proxmox cluster the vms/lxc/k8s luster will be created in.</p> <p>Example:</p> <pre><code>\"proxmox-cluster-a.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#78-property-k8s-kubespray-inventory-stack_name","title":"78. Property <code>K8s Kubespray Inventory &gt; stack_name</code>","text":"Type <code>string</code> Required Yes <p>Description: Your stack name, needs to be unique within the cloud domain.</p>"},{"location":"schemas/kubespray_inv_schema/#79-property-k8s-kubespray-inventory-static_includes","title":"79. Property <code>K8s Kubespray Inventory &gt; static_includes</code>","text":"Type <code>object</code> Required Yes Additional properties Not allowed <p>Description: For virtual machines we have the option to define tcp_proxies and ingress_domains. If those are set we need certain static includes.</p> Property Pattern Type Deprecated Definition Title/Description + dhcp_stack No string No - For interacting with kea reservations. + proxy_stack No string No - Reloading the proxy. + postgres_stack No string No - The playbook needs the pve cloud postgres stack where state and general configuration is stored. + bind_stack No string No - The playbook needs the bind stack to register the general masters recordset and for creating authoritative zones defined in cluster_cert_entries. - cache_stack No string No - Cache stack to mount nfs for kubespray cache and apt cache. Assumes the cache lxc to have the hostname \"main\". WIP!"},{"location":"schemas/kubespray_inv_schema/#791-property-k8s-kubespray-inventory-static_includes-dhcp_stack","title":"79.1. Property <code>K8s Kubespray Inventory &gt; static_includes &gt; dhcp_stack</code>","text":"Type <code>string</code> Required Yes <p>Description: For interacting with kea reservations.</p> <p>Example:</p> <pre><code>\"dhcp.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#792-property-k8s-kubespray-inventory-static_includes-proxy_stack","title":"79.2. Property <code>K8s Kubespray Inventory &gt; static_includes &gt; proxy_stack</code>","text":"Type <code>string</code> Required Yes <p>Description: Reloading the proxy.</p> <p>Example:</p> <pre><code>\"proxy.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#793-property-k8s-kubespray-inventory-static_includes-postgres_stack","title":"79.3. Property <code>K8s Kubespray Inventory &gt; static_includes &gt; postgres_stack</code>","text":"Type <code>string</code> Required Yes <p>Description: The playbook needs the pve cloud postgres stack where state and general configuration is stored.</p> <p>Example:</p> <pre><code>\"patroni.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#794-property-k8s-kubespray-inventory-static_includes-bind_stack","title":"79.4. Property <code>K8s Kubespray Inventory &gt; static_includes &gt; bind_stack</code>","text":"Type <code>string</code> Required Yes <p>Description: The playbook needs the bind stack to register the general masters recordset and for creating authoritative zones defined in cluster_cert_entries.</p> <p>Example:</p> <pre><code>\"bind.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#795-property-k8s-kubespray-inventory-static_includes-cache_stack","title":"79.5. Property <code>K8s Kubespray Inventory &gt; static_includes &gt; cache_stack</code>","text":"Type <code>string</code> Required No <p>Description: Cache stack to mount nfs for kubespray cache and apt cache. Assumes the cache lxc to have the hostname \"main\". WIP!</p>"},{"location":"schemas/kubespray_inv_schema/#80-property-k8s-kubespray-inventory-include_stacks","title":"80. Property <code>K8s Kubespray Inventory &gt; include_stacks</code>","text":"Type <code>array of object</code> Required No <p>Description: Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description include_stacks items -"},{"location":"schemas/kubespray_inv_schema/#801-k8s-kubespray-inventory-include_stacks-include_stacks-items","title":"80.1. K8s Kubespray Inventory &gt; include_stacks &gt; include_stacks items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + stack_fqdn No string No - Target stack fqdn to include (stack name + pve_cloud_domain). Will automatically include it from the right pve cluster. + host_group No string No - This is the name of the hosts group of our ansible inventory the included vms/lxcs will be available under. - qemu_ansible_user No string No - User ansible will use to connect, defaults to admin. If you dont want to use debian cinit images you might need to set something else than admin.Ubuntu for example wont work if you set the cloud init user to admin."},{"location":"schemas/kubespray_inv_schema/#8011-property-k8s-kubespray-inventory-include_stacks-include_stacks-items-stack_fqdn","title":"80.1.1. Property <code>K8s Kubespray Inventory &gt; include_stacks &gt; include_stacks items &gt; stack_fqdn</code>","text":"Type <code>string</code> Required Yes <p>Description: Target stack fqdn to include (stack name + pve_cloud_domain). Will automatically include it from the right pve cluster.</p> <p>Examples:</p> <pre><code>\"bind.your-other-cloud.domain\"\n</code></pre> <pre><code>\"other-k8s.your-other-cloud.domain\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#8012-property-k8s-kubespray-inventory-include_stacks-include_stacks-items-host_group","title":"80.1.2. Property <code>K8s Kubespray Inventory &gt; include_stacks &gt; include_stacks items &gt; host_group</code>","text":"Type <code>string</code> Required Yes <p>Description: This is the name of the hosts group of our ansible inventory the included vms/lxcs will be available under.</p>"},{"location":"schemas/kubespray_inv_schema/#8013-property-k8s-kubespray-inventory-include_stacks-include_stacks-items-qemu_ansible_user","title":"80.1.3. Property <code>K8s Kubespray Inventory &gt; include_stacks &gt; include_stacks items &gt; qemu_ansible_user</code>","text":"Type <code>string</code> Required No <p>Description: User ansible will use to connect, defaults to admin. If you dont want to use debian cinit images you might need to set something else than admin. Ubuntu for example wont work if you set the cloud init user to admin.</p>"},{"location":"schemas/kubespray_inv_schema/#81-property-k8s-kubespray-inventory-root_ssh_pub_key","title":"81. Property <code>K8s Kubespray Inventory &gt; root_ssh_pub_key</code>","text":"Type <code>string</code> Required Yes <p>Description: trusted root key for the cloud init image.</p>"},{"location":"schemas/kubespray_inv_schema/#82-property-k8s-kubespray-inventory-pve_ha_group","title":"82. Property <code>K8s Kubespray Inventory &gt; pve_ha_group</code>","text":"Type <code>string</code> Required No <p>Description: PVE HA group this vm should be assigned to (optional).</p>"},{"location":"schemas/kubespray_inv_schema/#83-property-k8s-kubespray-inventory-target_pve_hosts","title":"83. Property <code>K8s Kubespray Inventory &gt; target_pve_hosts</code>","text":"Type <code>array of string</code> Required No <p>Description: Array of proxmox hosts in the target pve that are eligible for scheduling. If not specified all online hosts are considered.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description target_pve_hosts items The hostname of the proxmox host. Just the hostname, no cluster name or cloud domain should be specified, as they are implicit."},{"location":"schemas/kubespray_inv_schema/#831-k8s-kubespray-inventory-target_pve_hosts-target_pve_hosts-items","title":"83.1. K8s Kubespray Inventory &gt; target_pve_hosts &gt; target_pve_hosts items","text":"Type <code>string</code> Required No <p>Description: The hostname of the proxmox host. Just the hostname, no cluster name or cloud domain should be specified, as they are implicit.</p> <p>Example:</p> <pre><code>\"proxmox-host-a\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#84-property-k8s-kubespray-inventory-qemus","title":"84. Property <code>K8s Kubespray Inventory &gt; qemus</code>","text":"Type <code>array of object</code> Required Yes <p>Description: Nodes for the cluster in form of qemu vms.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description qemus items -"},{"location":"schemas/kubespray_inv_schema/#841-k8s-kubespray-inventory-qemus-qemus-items","title":"84.1. K8s Kubespray Inventory &gt; qemus &gt; qemus items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description - hostname No string No - Optional unique hostname for this node, otherwise pet name random name will be generated. - vars No object No - Custom variables for this node specifically, might be useful in your own custom playbooks. - target_host No string No - Optional specific proxmox host you want to tie this node to on creation. Can of course still be moved afterwards. Cloud domain is implicit and should not be specified. + parameters No object No - In accordance with pve qm cli tool, creation parameters mapped (key equals the --key part and value the passed value). - network_config No string No - Cinit network config yaml string. Will be the last cfg piece that gets merged into the final cloudinit network config. Can be used for overrides. + disk No object No - - + k8s_roles No array of enum (of string) No - String array of k8s roles."},{"location":"schemas/kubespray_inv_schema/#8411-property-k8s-kubespray-inventory-qemus-qemus-items-hostname","title":"84.1.1. Property <code>K8s Kubespray Inventory &gt; qemus &gt; qemus items &gt; hostname</code>","text":"Type <code>string</code> Required No <p>Description: Optional unique hostname for this node, otherwise pet name random name will be generated.</p>"},{"location":"schemas/kubespray_inv_schema/#8412-property-k8s-kubespray-inventory-qemus-qemus-items-vars","title":"84.1.2. Property <code>K8s Kubespray Inventory &gt; qemus &gt; qemus items &gt; vars</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Custom variables for this node specifically, might be useful in your own custom playbooks.</p>"},{"location":"schemas/kubespray_inv_schema/#8413-property-k8s-kubespray-inventory-qemus-qemus-items-target_host","title":"84.1.3. Property <code>K8s Kubespray Inventory &gt; qemus &gt; qemus items &gt; target_host</code>","text":"Type <code>string</code> Required No <p>Description: Optional specific proxmox host you want to tie this node to on creation. Can of course still be moved afterwards. Cloud domain is implicit and should not be specified.</p> <p>Example:</p> <pre><code>\"proxmox-host-B.proxmox-cluster-A\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#8414-property-k8s-kubespray-inventory-qemus-qemus-items-parameters","title":"84.1.4. Property <code>K8s Kubespray Inventory &gt; qemus &gt; qemus items &gt; parameters</code>","text":"Type <code>object</code> Required Yes Additional properties Any type allowed <p>Description: In accordance with pve qm cli tool, creation parameters mapped (key equals the --key part and value the passed value).</p> <p>Example:</p> <pre><code>{\n    \"cores\": 1,\n    \"memory\": 1024\n}\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#8415-property-k8s-kubespray-inventory-qemus-qemus-items-network_config","title":"84.1.5. Property <code>K8s Kubespray Inventory &gt; qemus &gt; qemus items &gt; network_config</code>","text":"Type <code>string</code> Required No <p>Description: Cinit network config yaml string. Will be the last cfg piece that gets merged into the final cloudinit network config. Can be used for overrides.</p>"},{"location":"schemas/kubespray_inv_schema/#8416-property-k8s-kubespray-inventory-qemus-qemus-items-disk","title":"84.1.6. Property <code>K8s Kubespray Inventory &gt; qemus &gt; qemus items &gt; disk</code>","text":"Type <code>object</code> Required Yes Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + size No string No - Size of the vms disk. - options No object No - Mount options + pool No string No - Ceph pool name the vms disk will be created in."},{"location":"schemas/kubespray_inv_schema/#84161-property-k8s-kubespray-inventory-qemus-qemus-items-disk-size","title":"84.1.6.1. Property <code>K8s Kubespray Inventory &gt; qemus &gt; qemus items &gt; disk &gt; size</code>","text":"Type <code>string</code> Required Yes <p>Description: Size of the vms disk.</p> <p>Example:</p> <pre><code>\"25G\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#84162-property-k8s-kubespray-inventory-qemus-qemus-items-disk-options","title":"84.1.6.2. Property <code>K8s Kubespray Inventory &gt; qemus &gt; qemus items &gt; disk &gt; options</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Mount options</p>"},{"location":"schemas/kubespray_inv_schema/#84163-property-k8s-kubespray-inventory-qemus-qemus-items-disk-pool","title":"84.1.6.3. Property <code>K8s Kubespray Inventory &gt; qemus &gt; qemus items &gt; disk &gt; pool</code>","text":"Type <code>string</code> Required Yes <p>Description: Ceph pool name the vms disk will be created in.</p>"},{"location":"schemas/kubespray_inv_schema/#8417-property-k8s-kubespray-inventory-qemus-qemus-items-k8s_roles","title":"84.1.7. Property <code>K8s Kubespray Inventory &gt; qemus &gt; qemus items &gt; k8s_roles</code>","text":"Type <code>array of enum (of string)</code> Required Yes <p>Description: String array of k8s roles.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description k8s_roles items -"},{"location":"schemas/kubespray_inv_schema/#84171-k8s-kubespray-inventory-qemus-qemus-items-k8s_roles-k8s_roles-items","title":"84.1.7.1. K8s Kubespray Inventory &gt; qemus &gt; qemus items &gt; k8s_roles &gt; k8s_roles items","text":"Type <code>enum (of string)</code> Required No <p>Must be one of:</p> <ul> <li>\"master\"</li> <li>\"worker\"</li> </ul>"},{"location":"schemas/kubespray_inv_schema/#85-property-k8s-kubespray-inventory-tcp_proxies","title":"85. Property <code>K8s Kubespray Inventory &gt; tcp_proxies</code>","text":"Type <code>array of object</code> Required No <p>Description: Raw tcp forwards on the clusters haproxy to k8s services exposed via nodeport.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description tcp_proxies items -"},{"location":"schemas/kubespray_inv_schema/#851-k8s-kubespray-inventory-tcp_proxies-tcp_proxies-items","title":"85.1. K8s Kubespray Inventory &gt; tcp_proxies &gt; tcp_proxies items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + proxy_name No string No - Simple name for the forward. Will be rendered in haproxy configuration so it shouldnt contain special characters. + haproxy_port No number No - Frontend port of the proxmox clusters haproxy. + node_port No number No - Nodeport of the k8s service. - proxy_snippet No string No - Additional snippet that will be inserted into the haproxy listen block. Can be used to adjust the forwards settings. - external No boolean No - Will also create a forward on the external floating ip of the proxy not only the internal."},{"location":"schemas/kubespray_inv_schema/#8511-property-k8s-kubespray-inventory-tcp_proxies-tcp_proxies-items-proxy_name","title":"85.1.1. Property <code>K8s Kubespray Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; proxy_name</code>","text":"Type <code>string</code> Required Yes <p>Description: Simple name for the forward. Will be rendered in haproxy configuration so it shouldnt contain special characters.</p> <p>Examples:</p> <pre><code>\"gitlab-ssh\"\n</code></pre> <pre><code>\"example-postgres\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#8512-property-k8s-kubespray-inventory-tcp_proxies-tcp_proxies-items-haproxy_port","title":"85.1.2. Property <code>K8s Kubespray Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; haproxy_port</code>","text":"Type <code>number</code> Required Yes <p>Description: Frontend port of the proxmox clusters haproxy.</p>"},{"location":"schemas/kubespray_inv_schema/#8513-property-k8s-kubespray-inventory-tcp_proxies-tcp_proxies-items-node_port","title":"85.1.3. Property <code>K8s Kubespray Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; node_port</code>","text":"Type <code>number</code> Required Yes <p>Description: Nodeport of the k8s service.</p>"},{"location":"schemas/kubespray_inv_schema/#8514-property-k8s-kubespray-inventory-tcp_proxies-tcp_proxies-items-proxy_snippet","title":"85.1.4. Property <code>K8s Kubespray Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; proxy_snippet</code>","text":"Type <code>string</code> Required No <p>Description: Additional snippet that will be inserted into the haproxy listen block. Can be used to adjust the forwards settings.</p> <p>Example:</p> <pre><code>\"# long running tcp connections that only rarely transmit data\\n# ssh client connection for example\\ntimeout client 1h \\ntimeout server 1h \\n\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#8515-property-k8s-kubespray-inventory-tcp_proxies-tcp_proxies-items-external","title":"85.1.5. Property <code>K8s Kubespray Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; external</code>","text":"Type <code>boolean</code> Required No <p>Description: Will also create a forward on the external floating ip of the proxy not only the internal.</p>"},{"location":"schemas/kubespray_inv_schema/#86-property-k8s-kubespray-inventory-qemu_default_user","title":"86. Property <code>K8s Kubespray Inventory &gt; qemu_default_user</code>","text":"Type <code>string</code> Required No <p>Description: User for cinit.</p>"},{"location":"schemas/kubespray_inv_schema/#87-property-k8s-kubespray-inventory-qemu_hashed_pw","title":"87. Property <code>K8s Kubespray Inventory &gt; qemu_hashed_pw</code>","text":"Type <code>string</code> Required No <p>Description: Pw for default user defaults to hashed 'password' for debian cloud init image. Different cloud init images require different hash methods. You cannot use the same from debian for ubuntu for example.</p>"},{"location":"schemas/kubespray_inv_schema/#88-property-k8s-kubespray-inventory-qemu_base_parameters","title":"88. Property <code>K8s Kubespray Inventory &gt; qemu_base_parameters</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Base parameters applied to all qemus. passed to the proxmox qm cli tool for creating vm.</p>"},{"location":"schemas/kubespray_inv_schema/#89-property-k8s-kubespray-inventory-qemu_image_url","title":"89. Property <code>K8s Kubespray Inventory &gt; qemu_image_url</code>","text":"Type <code>string</code> Required No <p>Description: http(s) download link for cloud init image.</p>"},{"location":"schemas/kubespray_inv_schema/#90-property-k8s-kubespray-inventory-qemu_keyboard_layout","title":"90. Property <code>K8s Kubespray Inventory &gt; qemu_keyboard_layout</code>","text":"Type <code>string</code> Required No <p>Description: Keyboard layout for cloudinit.</p>"},{"location":"schemas/kubespray_inv_schema/#91-property-k8s-kubespray-inventory-qemu_network_config","title":"91. Property <code>K8s Kubespray Inventory &gt; qemu_network_config</code>","text":"Type <code>string</code> Required No <p>Description: Optional qemu network config as a yaml string that is merged into the cloudinit network config of all qemus.</p>"},{"location":"schemas/kubespray_inv_schema/#92-property-k8s-kubespray-inventory-qemu_global_vars","title":"92. Property <code>K8s Kubespray Inventory &gt; qemu_global_vars</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Variables that will be applied set for all qemus vms.</p>"},{"location":"schemas/kubespray_inv_schema/#93-property-k8s-kubespray-inventory-plugin","title":"93. Property <code>K8s Kubespray Inventory &gt; plugin</code>","text":"Type <code>enum (of string)</code> Required No <p>Description: Id of ansible inventory plugin.</p> <p>Must be one of:</p> <ul> <li>\"pxc.cloud.qemu_inv\"</li> <li>\"pxc.cloud.kubespray_inv\"</li> </ul>"},{"location":"schemas/kubespray_inv_schema/#94-property-k8s-kubespray-inventory-extra_control_plane_sans","title":"94. Property <code>K8s Kubespray Inventory &gt; extra_control_plane_sans</code>","text":"Type <code>array of string</code> Required No <p>Description: Extra sans that kubespray will put in kubeapi generated certificates. Original kubespray variable is named supplementary_addresses_in_ssl_keys,  but is set via pve cloud kubespray custom inventory. Read the kubernetes page in pve cloud docs for more details.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description extra_control_plane_sans items -"},{"location":"schemas/kubespray_inv_schema/#941-k8s-kubespray-inventory-extra_control_plane_sans-extra_control_plane_sans-items","title":"94.1. K8s Kubespray Inventory &gt; extra_control_plane_sans &gt; extra_control_plane_sans items","text":"Type <code>string</code> Required No"},{"location":"schemas/kubespray_inv_schema/#95-property-k8s-kubespray-inventory-external_domains","title":"95. Property <code>K8s Kubespray Inventory &gt; external_domains</code>","text":"Type <code>array of object</code> Required No <p>Description: Domains that will be exposed to the public/external haproxy floating ip via haproxy sni matching to this cluster.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description external_domains items -"},{"location":"schemas/kubespray_inv_schema/#951-k8s-kubespray-inventory-external_domains-external_domains-items","title":"95.1. K8s Kubespray Inventory &gt; external_domains &gt; external_domains items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + zone No string No - DNS parent zone, should also be the zone that external records are made under in AWS for example. - expose_apex No boolean No - Expose the apex zone itself. For example if you have zone example.com then example.com will be routed to this cluster. + names No array of string No - -"},{"location":"schemas/kubespray_inv_schema/#9511-property-k8s-kubespray-inventory-external_domains-external_domains-items-zone","title":"95.1.1. Property <code>K8s Kubespray Inventory &gt; external_domains &gt; external_domains items &gt; zone</code>","text":"Type <code>string</code> Required Yes <p>Description: DNS parent zone, should also be the zone that external records are made under in AWS for example.</p>"},{"location":"schemas/kubespray_inv_schema/#9512-property-k8s-kubespray-inventory-external_domains-external_domains-items-expose_apex","title":"95.1.2. Property <code>K8s Kubespray Inventory &gt; external_domains &gt; external_domains items &gt; expose_apex</code>","text":"Type <code>boolean</code> Required No <p>Description: Expose the apex zone itself. For example if you have zone example.com then example.com will be routed to this cluster.</p>"},{"location":"schemas/kubespray_inv_schema/#9513-property-k8s-kubespray-inventory-external_domains-external_domains-items-names","title":"95.1.3. Property <code>K8s Kubespray Inventory &gt; external_domains &gt; external_domains items &gt; names</code>","text":"Type <code>array of string</code> Required Yes Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description names items Names of the zone that should be exposed."},{"location":"schemas/kubespray_inv_schema/#95131-k8s-kubespray-inventory-external_domains-external_domains-items-names-names-items","title":"95.1.3.1. K8s Kubespray Inventory &gt; external_domains &gt; external_domains items &gt; names &gt; names items","text":"Type <code>string</code> Required No <p>Description: Names of the zone that should be exposed.</p> <p>Examples:</p> <pre><code>\"*\"\n</code></pre> <pre><code>\"example-service\"\n</code></pre> <pre><code>\"*.subzone\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#96-property-k8s-kubespray-inventory-cluster_cert_entries","title":"96. Property <code>K8s Kubespray Inventory &gt; cluster_cert_entries</code>","text":"Type <code>array of object</code> Required Yes <p>Description: Content for the clusters acme tls certificate. If you have multiple proxmox clusters they need their own haproxy instances for ingress dns to work.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description cluster_cert_entries items -"},{"location":"schemas/kubespray_inv_schema/#961-k8s-kubespray-inventory-cluster_cert_entries-cluster_cert_entries-items","title":"96.1. K8s Kubespray Inventory &gt; cluster_cert_entries &gt; cluster_cert_entries items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + zone No string No - DNS parent zone, should be the apex zone in ionos/route53 for dns01 challenge. + names No array of string No - - - authoritative_zone No boolean No - This will cause the specified apex zone to be created as an authoritative zone in the proxmox clouds dns server. Ingress dns will only work for authoritative zones. - apex_zone_san No boolean No - Creates additional SAN for the zone, if you have *.example.com you will also get example.com in your certificate. Defaults to false."},{"location":"schemas/kubespray_inv_schema/#9611-property-k8s-kubespray-inventory-cluster_cert_entries-cluster_cert_entries-items-zone","title":"96.1.1. Property <code>K8s Kubespray Inventory &gt; cluster_cert_entries &gt; cluster_cert_entries items &gt; zone</code>","text":"Type <code>string</code> Required Yes <p>Description: DNS parent zone, should be the apex zone in ionos/route53 for dns01 challenge.</p>"},{"location":"schemas/kubespray_inv_schema/#9612-property-k8s-kubespray-inventory-cluster_cert_entries-cluster_cert_entries-items-names","title":"96.1.2. Property <code>K8s Kubespray Inventory &gt; cluster_cert_entries &gt; cluster_cert_entries items &gt; names</code>","text":"Type <code>array of string</code> Required Yes Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description names items SANs included in the certificate and basis for dns01 challenge."},{"location":"schemas/kubespray_inv_schema/#96121-k8s-kubespray-inventory-cluster_cert_entries-cluster_cert_entries-items-names-names-items","title":"96.1.2.1. K8s Kubespray Inventory &gt; cluster_cert_entries &gt; cluster_cert_entries items &gt; names &gt; names items","text":"Type <code>string</code> Required No <p>Description: SANs included in the certificate and basis for dns01 challenge.</p> <p>Examples:</p> <pre><code>\"*\"\n</code></pre> <pre><code>\"example-service\"\n</code></pre> <pre><code>\"*.subzone\"\n</code></pre>"},{"location":"schemas/kubespray_inv_schema/#9613-property-k8s-kubespray-inventory-cluster_cert_entries-cluster_cert_entries-items-authoritative_zone","title":"96.1.3. Property <code>K8s Kubespray Inventory &gt; cluster_cert_entries &gt; cluster_cert_entries items &gt; authoritative_zone</code>","text":"Type <code>boolean</code> Required No <p>Description: This will cause the specified apex zone to be created as an authoritative zone in the proxmox clouds dns server. Ingress dns will only work for authoritative zones.</p>"},{"location":"schemas/kubespray_inv_schema/#9614-property-k8s-kubespray-inventory-cluster_cert_entries-cluster_cert_entries-items-apex_zone_san","title":"96.1.4. Property <code>K8s Kubespray Inventory &gt; cluster_cert_entries &gt; cluster_cert_entries items &gt; apex_zone_san</code>","text":"Type <code>boolean</code> Required No <p>Description: Creates additional SAN for the zone, if you have *.example.com you will also get example.com in your certificate. Defaults to false.</p>"},{"location":"schemas/kubespray_inv_schema/#97-property-k8s-kubespray-inventory-ceph_csi_sc_pools","title":"97. Property <code>K8s Kubespray Inventory &gt; ceph_csi_sc_pools</code>","text":"Type <code>array of object</code> Required No <p>Description: Ceph pools that will be made available to the clusters Ceph CSI driver (optional).</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description ceph_csi_sc_pools items -"},{"location":"schemas/kubespray_inv_schema/#971-k8s-kubespray-inventory-ceph_csi_sc_pools-ceph_csi_sc_pools-items","title":"97.1. K8s Kubespray Inventory &gt; ceph_csi_sc_pools &gt; ceph_csi_sc_pools items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + name No string No - Name of the pool in the ceph of our PVE cluster. + default No boolean No - Whether or not the pool is the default storage class. + mount_options No array No - String array of mount options that will be set in the storage class and applied to pvs."},{"location":"schemas/kubespray_inv_schema/#9711-property-k8s-kubespray-inventory-ceph_csi_sc_pools-ceph_csi_sc_pools-items-name","title":"97.1.1. Property <code>K8s Kubespray Inventory &gt; ceph_csi_sc_pools &gt; ceph_csi_sc_pools items &gt; name</code>","text":"Type <code>string</code> Required Yes <p>Description: Name of the pool in the ceph of our PVE cluster.</p>"},{"location":"schemas/kubespray_inv_schema/#9712-property-k8s-kubespray-inventory-ceph_csi_sc_pools-ceph_csi_sc_pools-items-default","title":"97.1.2. Property <code>K8s Kubespray Inventory &gt; ceph_csi_sc_pools &gt; ceph_csi_sc_pools items &gt; default</code>","text":"Type <code>boolean</code> Required Yes <p>Description: Whether or not the pool is the default storage class.</p>"},{"location":"schemas/kubespray_inv_schema/#9713-property-k8s-kubespray-inventory-ceph_csi_sc_pools-ceph_csi_sc_pools-items-mount_options","title":"97.1.3. Property <code>K8s Kubespray Inventory &gt; ceph_csi_sc_pools &gt; ceph_csi_sc_pools items &gt; mount_options</code>","text":"Type <code>array</code> Required Yes <p>Description: String array of mount options that will be set in the storage class and applied to pvs.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation N/A"},{"location":"schemas/kubespray_inv_schema/#98-property-k8s-kubespray-inventory-acme_staging","title":"98. Property <code>K8s Kubespray Inventory &gt; acme_staging</code>","text":"Type <code>boolean</code> Required No <p>Description: If set to true will use acme staging directory for issueing certs.</p>"},{"location":"schemas/lxc_inv_schema/","title":"Lxc inv schema","text":"<p>Title: LXC Inventory</p> Type <code>object</code> Required No Additional properties Not allowed <p>Description: Inventory for creating lxcs on PVE.</p> Property Pattern Type Deprecated Definition Title/Description + target_pve No string No - Proxmox cluster name + . + pve cloud domain. This determines the cloud and the proxmox cluster the vms/lxc/k8s luster will be created in. + stack_name No string No - Your stack name, needs to be unique within the cloud domain. - static_includes No object No - This property contains specific hosts / stacks that need to be included for a schema extension. This way playbooks can staticallyreference a host group and assume it to be a certain stack (e.g. postgres/haproxy/dhcp). - include_stacks No array of object No - Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks. + root_ssh_pub_key No string No - trusted root key for the cloud init image. - pve_ha_group No string No - PVE HA group this vm should be assigned to (optional). - target_pve_hosts No array of string No - Array of proxmox hosts in the target pve that are eligible for scheduling. If not specified all online hosts are considered. + lxcs No array of object No - List of lxcs that will be created for the stack. - lxc_global_vars No object No - Variables that will be applied to all lxc hosts and are available in playbooks. - lxc_base_parameters No object No - PVE pct cli parameters that will be used for all lxcs. - lxc_os_template No string No - `pveam available --section system` / run `pveam update` for newest, PVE available LXC template (will be downloaded). - plugin No enum (of string) No - Id of ansible inventory plugin."},{"location":"schemas/lxc_inv_schema/#56-property-lxc-inventory-target_pve","title":"56. Property <code>LXC Inventory &gt; target_pve</code>","text":"Type <code>string</code> Required Yes <p>Description: Proxmox cluster name + . + pve cloud domain. This determines the cloud and the proxmox cluster the vms/lxc/k8s luster will be created in.</p> <p>Example:</p> <pre><code>\"proxmox-cluster-a.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/lxc_inv_schema/#57-property-lxc-inventory-stack_name","title":"57. Property <code>LXC Inventory &gt; stack_name</code>","text":"Type <code>string</code> Required Yes <p>Description: Your stack name, needs to be unique within the cloud domain.</p>"},{"location":"schemas/lxc_inv_schema/#58-property-lxc-inventory-static_includes","title":"58. Property <code>LXC Inventory &gt; static_includes</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: This property contains specific hosts / stacks that need to be included for a schema extension. This way playbooks can statically reference a host group and assume it to be a certain stack (e.g. postgres/haproxy/dhcp).</p>"},{"location":"schemas/lxc_inv_schema/#59-property-lxc-inventory-include_stacks","title":"59. Property <code>LXC Inventory &gt; include_stacks</code>","text":"Type <code>array of object</code> Required No <p>Description: Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description include_stacks items -"},{"location":"schemas/lxc_inv_schema/#591-lxc-inventory-include_stacks-include_stacks-items","title":"59.1. LXC Inventory &gt; include_stacks &gt; include_stacks items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + stack_fqdn No string No - Target stack fqdn to include (stack name + pve_cloud_domain). Will automatically include it from the right pve cluster. + host_group No string No - This is the name of the hosts group of our ansible inventory the included vms/lxcs will be available under. - qemu_ansible_user No string No - User ansible will use to connect, defaults to admin. If you dont want to use debian cinit images you might need to set something else than admin.Ubuntu for example wont work if you set the cloud init user to admin."},{"location":"schemas/lxc_inv_schema/#5911-property-lxc-inventory-include_stacks-include_stacks-items-stack_fqdn","title":"59.1.1. Property <code>LXC Inventory &gt; include_stacks &gt; include_stacks items &gt; stack_fqdn</code>","text":"Type <code>string</code> Required Yes <p>Description: Target stack fqdn to include (stack name + pve_cloud_domain). Will automatically include it from the right pve cluster.</p> <p>Examples:</p> <pre><code>\"bind.your-other-cloud.domain\"\n</code></pre> <pre><code>\"other-k8s.your-other-cloud.domain\"\n</code></pre>"},{"location":"schemas/lxc_inv_schema/#5912-property-lxc-inventory-include_stacks-include_stacks-items-host_group","title":"59.1.2. Property <code>LXC Inventory &gt; include_stacks &gt; include_stacks items &gt; host_group</code>","text":"Type <code>string</code> Required Yes <p>Description: This is the name of the hosts group of our ansible inventory the included vms/lxcs will be available under.</p>"},{"location":"schemas/lxc_inv_schema/#5913-property-lxc-inventory-include_stacks-include_stacks-items-qemu_ansible_user","title":"59.1.3. Property <code>LXC Inventory &gt; include_stacks &gt; include_stacks items &gt; qemu_ansible_user</code>","text":"Type <code>string</code> Required No <p>Description: User ansible will use to connect, defaults to admin. If you dont want to use debian cinit images you might need to set something else than admin. Ubuntu for example wont work if you set the cloud init user to admin.</p>"},{"location":"schemas/lxc_inv_schema/#60-property-lxc-inventory-root_ssh_pub_key","title":"60. Property <code>LXC Inventory &gt; root_ssh_pub_key</code>","text":"Type <code>string</code> Required Yes <p>Description: trusted root key for the cloud init image.</p>"},{"location":"schemas/lxc_inv_schema/#61-property-lxc-inventory-pve_ha_group","title":"61. Property <code>LXC Inventory &gt; pve_ha_group</code>","text":"Type <code>string</code> Required No <p>Description: PVE HA group this vm should be assigned to (optional).</p>"},{"location":"schemas/lxc_inv_schema/#62-property-lxc-inventory-target_pve_hosts","title":"62. Property <code>LXC Inventory &gt; target_pve_hosts</code>","text":"Type <code>array of string</code> Required No <p>Description: Array of proxmox hosts in the target pve that are eligible for scheduling. If not specified all online hosts are considered.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description target_pve_hosts items The hostname of the proxmox host. Just the hostname, no cluster name or cloud domain should be specified, as they are implicit."},{"location":"schemas/lxc_inv_schema/#621-lxc-inventory-target_pve_hosts-target_pve_hosts-items","title":"62.1. LXC Inventory &gt; target_pve_hosts &gt; target_pve_hosts items","text":"Type <code>string</code> Required No <p>Description: The hostname of the proxmox host. Just the hostname, no cluster name or cloud domain should be specified, as they are implicit.</p> <p>Example:</p> <pre><code>\"proxmox-host-a\"\n</code></pre>"},{"location":"schemas/lxc_inv_schema/#63-property-lxc-inventory-lxcs","title":"63. Property <code>LXC Inventory &gt; lxcs</code>","text":"Type <code>array of object</code> Required Yes <p>Description: List of lxcs that will be created for the stack.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description lxcs items -"},{"location":"schemas/lxc_inv_schema/#631-lxc-inventory-lxcs-lxcs-items","title":"63.1. LXC Inventory &gt; lxcs &gt; lxcs items","text":"Type <code>object</code> Required No Additional properties Any type allowed Property Pattern Type Deprecated Definition Title/Description - hostname No string No - Optional unique hostname for this lxc, otherwise pet name random name will be generated. - target_host No string No - Pve host to tie this vm to. This is useful to always deploy specifically on a proxmox host. - vars No object No - Custom variables for this lxc specifically. Will be usable in playbooks. + parameters No object No - Parameters that will be passed to pve pct cli tool for lxc creation."},{"location":"schemas/lxc_inv_schema/#6311-property-lxc-inventory-lxcs-lxcs-items-hostname","title":"63.1.1. Property <code>LXC Inventory &gt; lxcs &gt; lxcs items &gt; hostname</code>","text":"Type <code>string</code> Required No <p>Description: Optional unique hostname for this lxc, otherwise pet name random name will be generated.</p>"},{"location":"schemas/lxc_inv_schema/#6312-property-lxc-inventory-lxcs-lxcs-items-target_host","title":"63.1.2. Property <code>LXC Inventory &gt; lxcs &gt; lxcs items &gt; target_host</code>","text":"Type <code>string</code> Required No <p>Description: Pve host to tie this vm to. This is useful to always deploy specifically on a proxmox host.</p>"},{"location":"schemas/lxc_inv_schema/#6313-property-lxc-inventory-lxcs-lxcs-items-vars","title":"63.1.3. Property <code>LXC Inventory &gt; lxcs &gt; lxcs items &gt; vars</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Custom variables for this lxc specifically. Will be usable in playbooks.</p>"},{"location":"schemas/lxc_inv_schema/#6314-property-lxc-inventory-lxcs-lxcs-items-parameters","title":"63.1.4. Property <code>LXC Inventory &gt; lxcs &gt; lxcs items &gt; parameters</code>","text":"Type <code>object</code> Required Yes Additional properties Any type allowed <p>Description: Parameters that will be passed to pve pct cli tool for lxc creation.</p> Property Pattern Type Deprecated Definition Title/Description + rootfs No string No - PVE storage for the container disk. + cores No integer No - Number of virtual CPU cores. + memory No integer No - Memory in bytes, use POW 2. + net0 No string No - Configuration for primary network interface."},{"location":"schemas/lxc_inv_schema/#63141-property-lxc-inventory-lxcs-lxcs-items-parameters-rootfs","title":"63.1.4.1. Property <code>LXC Inventory &gt; lxcs &gt; lxcs items &gt; parameters &gt; rootfs</code>","text":"Type <code>string</code> Required Yes <p>Description: PVE storage for the container disk.</p>"},{"location":"schemas/lxc_inv_schema/#63142-property-lxc-inventory-lxcs-lxcs-items-parameters-cores","title":"63.1.4.2. Property <code>LXC Inventory &gt; lxcs &gt; lxcs items &gt; parameters &gt; cores</code>","text":"Type <code>integer</code> Required Yes <p>Description: Number of virtual CPU cores.</p>"},{"location":"schemas/lxc_inv_schema/#63143-property-lxc-inventory-lxcs-lxcs-items-parameters-memory","title":"63.1.4.3. Property <code>LXC Inventory &gt; lxcs &gt; lxcs items &gt; parameters &gt; memory</code>","text":"Type <code>integer</code> Required Yes <p>Description: Memory in bytes, use POW 2.</p>"},{"location":"schemas/lxc_inv_schema/#63144-property-lxc-inventory-lxcs-lxcs-items-parameters-net0","title":"63.1.4.4. Property <code>LXC Inventory &gt; lxcs &gt; lxcs items &gt; parameters &gt; net0</code>","text":"Type <code>string</code> Required Yes <p>Description: Configuration for primary network interface.</p> <p>Example:</p> <pre><code>\"name=eth0,bridge=vmbr0,tag=120,firewall=1,ip=dhcp\"\n</code></pre>"},{"location":"schemas/lxc_inv_schema/#64-property-lxc-inventory-lxc_global_vars","title":"64. Property <code>LXC Inventory &gt; lxc_global_vars</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Variables that will be applied to all lxc hosts and are available in playbooks.</p> Property Pattern Type Deprecated Definition Title/Description - use_alternate_ssh_port No boolean No - Will use 2222 instead of 22 for ssh. - install_prom_systemd_exporter No boolean No - Will install prometheus metrics exporter for systemd. This implements with pve cloud terraform monitoring modules. -  No object No - -"},{"location":"schemas/lxc_inv_schema/#641-property-lxc-inventory-lxc_global_vars-use_alternate_ssh_port","title":"64.1. Property <code>LXC Inventory &gt; lxc_global_vars &gt; use_alternate_ssh_port</code>","text":"Type <code>boolean</code> Required No <p>Description: Will use 2222 instead of 22 for ssh.</p>"},{"location":"schemas/lxc_inv_schema/#642-property-lxc-inventory-lxc_global_vars-install_prom_systemd_exporter","title":"64.2. Property <code>LXC Inventory &gt; lxc_global_vars &gt; install_prom_systemd_exporter</code>","text":"Type <code>boolean</code> Required No <p>Description: Will install prometheus metrics exporter for systemd. This implements with pve cloud terraform monitoring modules.</p>"},{"location":"schemas/lxc_inv_schema/#65-property-lxc-inventory-lxc_base_parameters","title":"65. Property <code>LXC Inventory &gt; lxc_base_parameters</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: PVE pct cli parameters that will be used for all lxcs.</p>"},{"location":"schemas/lxc_inv_schema/#66-property-lxc-inventory-lxc_os_template","title":"66. Property <code>LXC Inventory &gt; lxc_os_template</code>","text":"Type <code>string</code> Required No <p>Description: <code>pveam available --section system</code> / run <code>pveam update</code> for newest, PVE available LXC template (will be downloaded).</p>"},{"location":"schemas/lxc_inv_schema/#67-property-lxc-inventory-plugin","title":"67. Property <code>LXC Inventory &gt; plugin</code>","text":"Type <code>enum (of string)</code> Required No <p>Description: Id of ansible inventory plugin.</p> <p>Must be one of:</p> <ul> <li>\"pxc.cloud.lxc_inv\"</li> </ul>"},{"location":"schemas/pve_cloud_inv_schema/","title":"Pve cloud inv schema","text":"<p>Title: Cloud Inventory</p> Type <code>object</code> Required No Additional properties Not allowed <p>Description: Definitions for a proxmox cloud, setup of proxmox clusters.</p> Property Pattern Type Deprecated Definition Title/Description + pve_vm_subnet No string No - Subnet this PVE cluster uses for its VMs. + pve_cloud_domain No string No - The overarching domain for the cloud. Will also be used for ddns. + kea_dhcp_main_ip No string No - Static assigned ip for the main dhcp server. This has to match your dhcp lxc inventory file! + kea_dhcp_failover_ip No string No - Static ip for slave dhcp server. This has to match your dhcp lxc inventory file! + kea_dhcp_routers No string No - option-data for kea dhcp routers. The default route router that the dhcp will communicate. + kea_dhcp_pools No array of string No - Address pools that the dhcp allocates from. Has to be within pve_vm_subnet cidr. + kea_dhcp_static_routes No string No - classless-static-routes for kea option-data. You can pass comma seperated extra routes you want the dhcp to communicate, for example to a custom VPN gateway. + bind_master_ip No string No - IP of the primary bind dns for this cluster, will be statically assigned. Has to match your bind lxc inventory file! + bind_slave_ip No string No - IP of the slave bind dns for this cluster. Has to match your bind lxc inventory file! + bind_arpa_zone_service_lxcs No string No - Arpa zone in which service lxcs with static ips will manuall get their reverse dns entries. + bind_additional_arpa_zones No array of string No - Additional arpa zones which should be created and managed in the dns / dhcp ddns. + pve_clusters No object No - Definitions for specific Proxmox clusters that will be part of the cloud. Keys are hostnames. + bind_zone_admin_email No string No - Required adminstrator email in bind format for bind zones. - bind_forward_zones No array of object No - Creates zone in bind and delegation ns records to the specified nameservers. This is very useful if you have other nameservers with their own authoritative zones you want resolved within the cloud. - acme_contact No string No - Email address to use for acme account creation. - acme_method No enum (of string) No - PVE Cloud included method for solving dns01 challenges. You need to have created the appropriate secrets under /etc/pve/cloud on your proxmox cluster. - plugin No enum (of string) No - Id of ansible inventory plugin, needs to be set exactly."},{"location":"schemas/pve_cloud_inv_schema/#1-property-cloud-inventory-pve_vm_subnet","title":"1. Property <code>Cloud Inventory &gt; pve_vm_subnet</code>","text":"Type <code>string</code> Required Yes <p>Description: Subnet this PVE cluster uses for its VMs.</p> <p>Example:</p> <pre><code>\"192.168.10.0/24\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#2-property-cloud-inventory-pve_cloud_domain","title":"2. Property <code>Cloud Inventory &gt; pve_cloud_domain</code>","text":"Type <code>string</code> Required Yes <p>Description: The overarching domain for the cloud. Will also be used for ddns.</p> <p>Example:</p> <pre><code>\"your-cloud.example.com\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#3-property-cloud-inventory-kea_dhcp_main_ip","title":"3. Property <code>Cloud Inventory &gt; kea_dhcp_main_ip</code>","text":"Type <code>string</code> Required Yes <p>Description: Static assigned ip for the main dhcp server. This has to match your dhcp lxc inventory file!</p> <p>Example:</p> <pre><code>\"192.168.1.2\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#4-property-cloud-inventory-kea_dhcp_failover_ip","title":"4. Property <code>Cloud Inventory &gt; kea_dhcp_failover_ip</code>","text":"Type <code>string</code> Required Yes <p>Description: Static ip for slave dhcp server. This has to match your dhcp lxc inventory file!</p> <p>Example:</p> <pre><code>\"192.168.1.3\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#5-property-cloud-inventory-kea_dhcp_routers","title":"5. Property <code>Cloud Inventory &gt; kea_dhcp_routers</code>","text":"Type <code>string</code> Required Yes <p>Description: option-data for kea dhcp routers. The default route router that the dhcp will communicate.</p>"},{"location":"schemas/pve_cloud_inv_schema/#6-property-cloud-inventory-kea_dhcp_pools","title":"6. Property <code>Cloud Inventory &gt; kea_dhcp_pools</code>","text":"Type <code>array of string</code> Required Yes <p>Description: Address pools that the dhcp allocates from. Has to be within pve_vm_subnet cidr.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description kea_dhcp_pools items IPV4 Address range in keas format."},{"location":"schemas/pve_cloud_inv_schema/#61-cloud-inventory-kea_dhcp_pools-kea_dhcp_pools-items","title":"6.1. Cloud Inventory &gt; kea_dhcp_pools &gt; kea_dhcp_pools items","text":"Type <code>string</code> Required No <p>Description: IPV4 Address range in keas format.</p> <p>Example:</p> <pre><code>\"192.168.1.30 - 192.168.1.254\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#7-property-cloud-inventory-kea_dhcp_static_routes","title":"7. Property <code>Cloud Inventory &gt; kea_dhcp_static_routes</code>","text":"Type <code>string</code> Required Yes <p>Description: classless-static-routes for kea option-data. You can pass comma seperated extra routes you want the dhcp to communicate, for example to a custom VPN gateway.</p> <p>Example:</p> <pre><code>\"0.0.0.0/0 - 192.168.1.1, 10.0.0.1/24 - 192.168.1.20\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#8-property-cloud-inventory-bind_master_ip","title":"8. Property <code>Cloud Inventory &gt; bind_master_ip</code>","text":"Type <code>string</code> Required Yes <p>Description: IP of the primary bind dns for this cluster, will be statically assigned. Has to match your bind lxc inventory file!</p> <p>Example:</p> <pre><code>\"192.168.1.4\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#9-property-cloud-inventory-bind_slave_ip","title":"9. Property <code>Cloud Inventory &gt; bind_slave_ip</code>","text":"Type <code>string</code> Required Yes <p>Description: IP of the slave bind dns for this cluster. Has to match your bind lxc inventory file!</p> <p>Example:</p> <pre><code>\"192.168.1.5\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#10-property-cloud-inventory-bind_arpa_zone_service_lxcs","title":"10. Property <code>Cloud Inventory &gt; bind_arpa_zone_service_lxcs</code>","text":"Type <code>string</code> Required Yes <p>Description: Arpa zone in which service lxcs with static ips will manuall get their reverse dns entries.</p> <p>Example:</p> <pre><code>\"1.168.192.in-addr.arpa\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#11-property-cloud-inventory-bind_additional_arpa_zones","title":"11. Property <code>Cloud Inventory &gt; bind_additional_arpa_zones</code>","text":"Type <code>array of string</code> Required Yes <p>Description: Additional arpa zones which should be created and managed in the dns / dhcp ddns.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description bind_additional_arpa_zones items -"},{"location":"schemas/pve_cloud_inv_schema/#111-cloud-inventory-bind_additional_arpa_zones-bind_additional_arpa_zones-items","title":"11.1. Cloud Inventory &gt; bind_additional_arpa_zones &gt; bind_additional_arpa_zones items","text":"Type <code>string</code> Required No"},{"location":"schemas/pve_cloud_inv_schema/#12-property-cloud-inventory-pve_clusters","title":"12. Property <code>Cloud Inventory &gt; pve_clusters</code>","text":"Type <code>object</code> Required Yes Additional properties Not allowed <p>Description: Definitions for specific Proxmox clusters that will be part of the cloud. Keys are hostnames.</p> Property Pattern Type Deprecated Definition Title/Description - ^(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)(?:.(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?))*$ Yes object No - Cloud config for specific proxmox clusters."},{"location":"schemas/pve_cloud_inv_schema/#121-pattern-property-cloud-inventory-pve_clusters-cloud-config-for-specific-proxmox-clusters","title":"12.1. Pattern Property <code>Cloud Inventory &gt; pve_clusters &gt; Cloud config for specific proxmox clusters.</code>","text":"<p>All properties whose name matches the regular expression <code>^(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)(?:\\.(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?))*$</code> (Test) must respect the following conditions</p> <p>Title: Cloud config for specific proxmox clusters.</p> Type <code>object</code> Required No Additional properties Not allowed <p>Description: This object contains configuration parameters for a proxmox cluster within a proxmox cloud.</p> Property Pattern Type Deprecated Definition Title/Description - pve_haproxy_floating_ip_internal No string No - Floating ip that is exclusively accessible from inside the cloud / location. External forwardings should be made to pve_haproxy_floating_ip_external.Inside the cloud if you define a certificate entry, some nodeport forward or default kubeapi access, this will all be available automatically on this ip. - pve_haproxy_floating_ip_external No string No - Floating ip of our central cluster HAProxy. + pve_unique_cloud_services No array of enum (of string) No - Unique service the cluster provides for its cloud. Unique in the sense that only one cluster may provide each of the services for the entire cloud.Services like haproxy and backup servers can and should be provided by multiple clusters.  - pve_host_vars No object No - Optional variables that will be specifically set for a pve host. Key is the simple host name. This can be used to build your specialized pve cluster setup playbooks. You can do things likewakeonlan, driver and network configuration with these easily. Simply create your own playbook andrun it even before the pxc.cloud.setup_pve_clusters on this inventory."},{"location":"schemas/pve_cloud_inv_schema/#1211-property-cloud-inventory-pve_clusters-cloud-config-for-specific-proxmox-clusters-pve_haproxy_floating_ip_internal","title":"12.1.1. Property <code>Cloud Inventory &gt; pve_clusters &gt; Cloud config for specific proxmox clusters. &gt; pve_haproxy_floating_ip_internal</code>","text":"Type <code>string</code> Required No <p>Description: Floating ip that is exclusively accessible from inside the cloud / location. External forwardings should be made to pve_haproxy_floating_ip_external. Inside the cloud if you define a certificate entry, some nodeport forward or default kubeapi access, this will all be available automatically on this ip.</p> <p>Example:</p> <pre><code>\"192.168.10.6\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#1212-property-cloud-inventory-pve_clusters-cloud-config-for-specific-proxmox-clusters-pve_haproxy_floating_ip_external","title":"12.1.2. Property <code>Cloud Inventory &gt; pve_clusters &gt; Cloud config for specific proxmox clusters. &gt; pve_haproxy_floating_ip_external</code>","text":"Type <code>string</code> Required No <p>Description: Floating ip of our central cluster HAProxy.</p> <p>Example:</p> <pre><code>\"192.168.10.7\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#1213-property-cloud-inventory-pve_clusters-cloud-config-for-specific-proxmox-clusters-pve_unique_cloud_services","title":"12.1.3. Property <code>Cloud Inventory &gt; pve_clusters &gt; Cloud config for specific proxmox clusters. &gt; pve_unique_cloud_services</code>","text":"Type <code>array of enum (of string)</code> Required Yes <p>Description: Unique service the cluster provides for its cloud. Unique in the sense that only one cluster may provide each of the services for the entire cloud. Services like haproxy and backup servers can and should be provided by multiple clusters. </p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description pve_unique_cloud_services items -"},{"location":"schemas/pve_cloud_inv_schema/#12131-cloud-inventory-pve_clusters-cloud-config-for-specific-proxmox-clusters-pve_unique_cloud_services-pve_unique_cloud_services-items","title":"12.1.3.1. Cloud Inventory &gt; pve_clusters &gt; Cloud config for specific proxmox clusters. &gt; pve_unique_cloud_services &gt; pve_unique_cloud_services items","text":"Type <code>enum (of string)</code> Required No <p>Must be one of:</p> <ul> <li>\"dns\"</li> <li>\"dhcp\"</li> <li>\"psql-state\"</li> </ul>"},{"location":"schemas/pve_cloud_inv_schema/#1214-property-cloud-inventory-pve_clusters-cloud-config-for-specific-proxmox-clusters-pve_host_vars","title":"12.1.4. Property <code>Cloud Inventory &gt; pve_clusters &gt; Cloud config for specific proxmox clusters. &gt; pve_host_vars</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Optional variables that will be specifically set for a pve host. Key is the simple host name.  This can be used to build your specialized pve cluster setup playbooks. You can do things like wakeonlan, driver and network configuration with these easily. Simply create your own playbook and run it even before the pxc.cloud.setup_pve_clusters on this inventory.</p> Property Pattern Type Deprecated Definition Title/Description - disable_ipmi No boolean No - If specified will disable the openipmi power managemend systemd service. This might fail on proxmoxhosts that dont support it and clutters up monitoring. -  No object No - -"},{"location":"schemas/pve_cloud_inv_schema/#12141-property-cloud-inventory-pve_clusters-cloud-config-for-specific-proxmox-clusters-pve_host_vars-disable_ipmi","title":"12.1.4.1. Property <code>Cloud Inventory &gt; pve_clusters &gt; Cloud config for specific proxmox clusters. &gt; pve_host_vars &gt; disable_ipmi</code>","text":"Type <code>boolean</code> Required No <p>Description: If specified will disable the openipmi power managemend systemd service. This might fail on proxmox hosts that dont support it and clutters up monitoring.</p>"},{"location":"schemas/pve_cloud_inv_schema/#13-property-cloud-inventory-bind_zone_admin_email","title":"13. Property <code>Cloud Inventory &gt; bind_zone_admin_email</code>","text":"Type <code>string</code> Required Yes <p>Description: Required adminstrator email in bind format for bind zones.</p> <p>Example:</p> <pre><code>\"admin.example.com.\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#14-property-cloud-inventory-bind_forward_zones","title":"14. Property <code>Cloud Inventory &gt; bind_forward_zones</code>","text":"Type <code>array of object</code> Required No <p>Description: Creates zone in bind and delegation ns records to the specified nameservers. This is very useful if you have other nameservers with  their own authoritative zones you want resolved within the cloud.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description bind_forward_zones items -"},{"location":"schemas/pve_cloud_inv_schema/#141-cloud-inventory-bind_forward_zones-bind_forward_zones-items","title":"14.1. Cloud Inventory &gt; bind_forward_zones &gt; bind_forward_zones items","text":"Type <code>object</code> Required No Additional properties Any type allowed Property Pattern Type Deprecated Definition Title/Description - zone No string No - - - nameservers No array of string No - -"},{"location":"schemas/pve_cloud_inv_schema/#1411-property-cloud-inventory-bind_forward_zones-bind_forward_zones-items-zone","title":"14.1.1. Property <code>Cloud Inventory &gt; bind_forward_zones &gt; bind_forward_zones items &gt; zone</code>","text":"Type <code>string</code> Required No"},{"location":"schemas/pve_cloud_inv_schema/#1412-property-cloud-inventory-bind_forward_zones-bind_forward_zones-items-nameservers","title":"14.1.2. Property <code>Cloud Inventory &gt; bind_forward_zones &gt; bind_forward_zones items &gt; nameservers</code>","text":"Type <code>array of string</code> Required No Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description nameservers items -"},{"location":"schemas/pve_cloud_inv_schema/#14121-cloud-inventory-bind_forward_zones-bind_forward_zones-items-nameservers-nameservers-items","title":"14.1.2.1. Cloud Inventory &gt; bind_forward_zones &gt; bind_forward_zones items &gt; nameservers &gt; nameservers items","text":"Type <code>string</code> Required No"},{"location":"schemas/pve_cloud_inv_schema/#15-property-cloud-inventory-acme_contact","title":"15. Property <code>Cloud Inventory &gt; acme_contact</code>","text":"Type <code>string</code> Required No <p>Description: Email address to use for acme account creation.</p> <p>Example:</p> <pre><code>\"acme@example.com\"\n</code></pre>"},{"location":"schemas/pve_cloud_inv_schema/#16-property-cloud-inventory-acme_method","title":"16. Property <code>Cloud Inventory &gt; acme_method</code>","text":"Type <code>enum (of string)</code> Required No <p>Description: PVE Cloud included method for solving dns01 challenges. You need to have created the appropriate secrets under /etc/pve/cloud on your proxmox cluster.</p> <p>Must be one of:</p> <ul> <li>\"route53\"</li> <li>\"ionos\"</li> </ul>"},{"location":"schemas/pve_cloud_inv_schema/#17-property-cloud-inventory-plugin","title":"17. Property <code>Cloud Inventory &gt; plugin</code>","text":"Type <code>enum (of string)</code> Required No <p>Description: Id of ansible inventory plugin, needs to be set exactly.</p> <p>Must be one of:</p> <ul> <li>\"pxc.cloud.pve_cloud_inv\"</li> </ul>"},{"location":"schemas/qemu_inv_schema/","title":"Qemu inv schema","text":"<p>Title: VM Inventory</p> Type <code>object</code> Required No Additional properties Not allowed <p>Description: Inventory for deploying qemu VMs on PVE.</p> Property Pattern Type Deprecated Definition Title/Description + target_pve No string No - Proxmox cluster name + . + pve cloud domain. This determines the cloud and the proxmox cluster the vms/lxc/k8s luster will be created in. + stack_name No string No - Your stack name, needs to be unique within the cloud domain. - static_includes No object No - For virtual machines we have the option to define tcp_proxies and ingress_domains. If those are set we need certain static includes. - include_stacks No array of object No - Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks. + root_ssh_pub_key No string No - trusted root key for the cloud init image. - pve_ha_group No string No - PVE HA group this vm should be assigned to (optional). - target_pve_hosts No array of string No - Array of proxmox hosts in the target pve that are eligible for scheduling. If not specified all online hosts are considered. + qemus No array of object No - List of qemu vms for the stack. - tcp_proxies No array of object No - Raw tcp forwards on the clusters haproxy to k8s services exposed via nodeport. - qemu_default_user No string No - User for cinit. - qemu_hashed_pw No string No - Pw for default user defaults to hashed 'password' for debian cloud init image. Different cloud init images require different hash methods. You cannot use the same from debian for ubuntu for example. - qemu_base_parameters No object No - Base parameters applied to all qemus. passed to the proxmox qm cli tool for creating vm. - qemu_image_url No string No - http(s) download link for cloud init image. - qemu_keyboard_layout No string No - Keyboard layout for cloudinit. - qemu_network_config No string No - Optional qemu network config as a yaml string that is merged into the cloudinit network config of all qemus. - qemu_global_vars No object No - Variables that will be applied set for all qemus vms. - plugin No enum (of string) No - Id of ansible inventory plugin - ingress_domains No array of object No - Specific non ingress routing, via hostname lookup inside the proxy. This allows easy integration of standalone services like mailcow or other standalone deployments that do their own ingress termination."},{"location":"schemas/qemu_inv_schema/#38-property-vm-inventory-target_pve","title":"38. Property <code>VM Inventory &gt; target_pve</code>","text":"Type <code>string</code> Required Yes <p>Description: Proxmox cluster name + . + pve cloud domain. This determines the cloud and the proxmox cluster the vms/lxc/k8s luster will be created in.</p> <p>Example:</p> <pre><code>\"proxmox-cluster-a.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#39-property-vm-inventory-stack_name","title":"39. Property <code>VM Inventory &gt; stack_name</code>","text":"Type <code>string</code> Required Yes <p>Description: Your stack name, needs to be unique within the cloud domain.</p>"},{"location":"schemas/qemu_inv_schema/#40-property-vm-inventory-static_includes","title":"40. Property <code>VM Inventory &gt; static_includes</code>","text":"Type <code>object</code> Required No Additional properties Not allowed <p>Description: For virtual machines we have the option to define tcp_proxies and ingress_domains. If those are set we need certain static includes.</p> Property Pattern Type Deprecated Definition Title/Description - dhcp_stack No string No - For interacting with kea reservations. - proxy_stack No string No - Reloading the proxy. - postgres_stack No string No - The playbook needs the pve cloud postgres stack where state and general configuration is stored. - bind_stack No string No - The playbook needs the bind stack to register the general masters recordset and for creating authoritative zones defined in cluster_cert_entries."},{"location":"schemas/qemu_inv_schema/#401-property-vm-inventory-static_includes-dhcp_stack","title":"40.1. Property <code>VM Inventory &gt; static_includes &gt; dhcp_stack</code>","text":"Type <code>string</code> Required No <p>Description: For interacting with kea reservations.</p> <p>Example:</p> <pre><code>\"dhcp.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#402-property-vm-inventory-static_includes-proxy_stack","title":"40.2. Property <code>VM Inventory &gt; static_includes &gt; proxy_stack</code>","text":"Type <code>string</code> Required No <p>Description: Reloading the proxy.</p> <p>Example:</p> <pre><code>\"proxy.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#403-property-vm-inventory-static_includes-postgres_stack","title":"40.3. Property <code>VM Inventory &gt; static_includes &gt; postgres_stack</code>","text":"Type <code>string</code> Required No <p>Description: The playbook needs the pve cloud postgres stack where state and general configuration is stored.</p> <p>Example:</p> <pre><code>\"patroni.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#404-property-vm-inventory-static_includes-bind_stack","title":"40.4. Property <code>VM Inventory &gt; static_includes &gt; bind_stack</code>","text":"Type <code>string</code> Required No <p>Description: The playbook needs the bind stack to register the general masters recordset and for creating authoritative zones defined in cluster_cert_entries.</p> <p>Example:</p> <pre><code>\"bind.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#41-property-vm-inventory-include_stacks","title":"41. Property <code>VM Inventory &gt; include_stacks</code>","text":"Type <code>array of object</code> Required No <p>Description: Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description include_stacks items -"},{"location":"schemas/qemu_inv_schema/#411-vm-inventory-include_stacks-include_stacks-items","title":"41.1. VM Inventory &gt; include_stacks &gt; include_stacks items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + stack_fqdn No string No - Target stack fqdn to include (stack name + pve_cloud_domain). Will automatically include it from the right pve cluster. + host_group No string No - This is the name of the hosts group of our ansible inventory the included vms/lxcs will be available under. - qemu_ansible_user No string No - User ansible will use to connect, defaults to admin. If you dont want to use debian cinit images you might need to set something else than admin.Ubuntu for example wont work if you set the cloud init user to admin."},{"location":"schemas/qemu_inv_schema/#4111-property-vm-inventory-include_stacks-include_stacks-items-stack_fqdn","title":"41.1.1. Property <code>VM Inventory &gt; include_stacks &gt; include_stacks items &gt; stack_fqdn</code>","text":"Type <code>string</code> Required Yes <p>Description: Target stack fqdn to include (stack name + pve_cloud_domain). Will automatically include it from the right pve cluster.</p> <p>Examples:</p> <pre><code>\"bind.your-other-cloud.domain\"\n</code></pre> <pre><code>\"other-k8s.your-other-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#4112-property-vm-inventory-include_stacks-include_stacks-items-host_group","title":"41.1.2. Property <code>VM Inventory &gt; include_stacks &gt; include_stacks items &gt; host_group</code>","text":"Type <code>string</code> Required Yes <p>Description: This is the name of the hosts group of our ansible inventory the included vms/lxcs will be available under.</p>"},{"location":"schemas/qemu_inv_schema/#4113-property-vm-inventory-include_stacks-include_stacks-items-qemu_ansible_user","title":"41.1.3. Property <code>VM Inventory &gt; include_stacks &gt; include_stacks items &gt; qemu_ansible_user</code>","text":"Type <code>string</code> Required No <p>Description: User ansible will use to connect, defaults to admin. If you dont want to use debian cinit images you might need to set something else than admin. Ubuntu for example wont work if you set the cloud init user to admin.</p>"},{"location":"schemas/qemu_inv_schema/#42-property-vm-inventory-root_ssh_pub_key","title":"42. Property <code>VM Inventory &gt; root_ssh_pub_key</code>","text":"Type <code>string</code> Required Yes <p>Description: trusted root key for the cloud init image.</p>"},{"location":"schemas/qemu_inv_schema/#43-property-vm-inventory-pve_ha_group","title":"43. Property <code>VM Inventory &gt; pve_ha_group</code>","text":"Type <code>string</code> Required No <p>Description: PVE HA group this vm should be assigned to (optional).</p>"},{"location":"schemas/qemu_inv_schema/#44-property-vm-inventory-target_pve_hosts","title":"44. Property <code>VM Inventory &gt; target_pve_hosts</code>","text":"Type <code>array of string</code> Required No <p>Description: Array of proxmox hosts in the target pve that are eligible for scheduling. If not specified all online hosts are considered.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description target_pve_hosts items The hostname of the proxmox host. Just the hostname, no cluster name or cloud domain should be specified, as they are implicit."},{"location":"schemas/qemu_inv_schema/#441-vm-inventory-target_pve_hosts-target_pve_hosts-items","title":"44.1. VM Inventory &gt; target_pve_hosts &gt; target_pve_hosts items","text":"Type <code>string</code> Required No <p>Description: The hostname of the proxmox host. Just the hostname, no cluster name or cloud domain should be specified, as they are implicit.</p> <p>Example:</p> <pre><code>\"proxmox-host-a\"\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#45-property-vm-inventory-qemus","title":"45. Property <code>VM Inventory &gt; qemus</code>","text":"Type <code>array of object</code> Required Yes <p>Description: List of qemu vms for the stack.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description qemus items -"},{"location":"schemas/qemu_inv_schema/#451-vm-inventory-qemus-qemus-items","title":"45.1. VM Inventory &gt; qemus &gt; qemus items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description - hostname No string No - Optional unique hostname for this node, otherwise pet name random name will be generated. - vars No object No - Custom variables for this node specifically, might be useful in your own custom playbooks. - target_host No string No - Optional specific proxmox host you want to tie this node to on creation. Can of course still be moved afterwards. Cloud domain is implicit and should not be specified. + parameters No object No - In accordance with pve qm cli tool, creation parameters mapped (key equals the --key part and value the passed value). - network_config No string No - Cinit network config yaml string. Will be the last cfg piece that gets merged into the final cloudinit network config. Can be used for overrides. + disk No object No - -"},{"location":"schemas/qemu_inv_schema/#4511-property-vm-inventory-qemus-qemus-items-hostname","title":"45.1.1. Property <code>VM Inventory &gt; qemus &gt; qemus items &gt; hostname</code>","text":"Type <code>string</code> Required No <p>Description: Optional unique hostname for this node, otherwise pet name random name will be generated.</p>"},{"location":"schemas/qemu_inv_schema/#4512-property-vm-inventory-qemus-qemus-items-vars","title":"45.1.2. Property <code>VM Inventory &gt; qemus &gt; qemus items &gt; vars</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Custom variables for this node specifically, might be useful in your own custom playbooks.</p>"},{"location":"schemas/qemu_inv_schema/#4513-property-vm-inventory-qemus-qemus-items-target_host","title":"45.1.3. Property <code>VM Inventory &gt; qemus &gt; qemus items &gt; target_host</code>","text":"Type <code>string</code> Required No <p>Description: Optional specific proxmox host you want to tie this node to on creation. Can of course still be moved afterwards. Cloud domain is implicit and should not be specified.</p> <p>Example:</p> <pre><code>\"proxmox-host-B.proxmox-cluster-A\"\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#4514-property-vm-inventory-qemus-qemus-items-parameters","title":"45.1.4. Property <code>VM Inventory &gt; qemus &gt; qemus items &gt; parameters</code>","text":"Type <code>object</code> Required Yes Additional properties Any type allowed <p>Description: In accordance with pve qm cli tool, creation parameters mapped (key equals the --key part and value the passed value).</p> <p>Example:</p> <pre><code>{\n    \"cores\": 1,\n    \"memory\": 1024\n}\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#4515-property-vm-inventory-qemus-qemus-items-network_config","title":"45.1.5. Property <code>VM Inventory &gt; qemus &gt; qemus items &gt; network_config</code>","text":"Type <code>string</code> Required No <p>Description: Cinit network config yaml string. Will be the last cfg piece that gets merged into the final cloudinit network config. Can be used for overrides.</p>"},{"location":"schemas/qemu_inv_schema/#4516-property-vm-inventory-qemus-qemus-items-disk","title":"45.1.6. Property <code>VM Inventory &gt; qemus &gt; qemus items &gt; disk</code>","text":"Type <code>object</code> Required Yes Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + size No string No - Size of the vms disk. - options No object No - Mount options + pool No string No - Ceph pool name the vms disk will be created in."},{"location":"schemas/qemu_inv_schema/#45161-property-vm-inventory-qemus-qemus-items-disk-size","title":"45.1.6.1. Property <code>VM Inventory &gt; qemus &gt; qemus items &gt; disk &gt; size</code>","text":"Type <code>string</code> Required Yes <p>Description: Size of the vms disk.</p> <p>Example:</p> <pre><code>\"25G\"\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#45162-property-vm-inventory-qemus-qemus-items-disk-options","title":"45.1.6.2. Property <code>VM Inventory &gt; qemus &gt; qemus items &gt; disk &gt; options</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Mount options</p>"},{"location":"schemas/qemu_inv_schema/#45163-property-vm-inventory-qemus-qemus-items-disk-pool","title":"45.1.6.3. Property <code>VM Inventory &gt; qemus &gt; qemus items &gt; disk &gt; pool</code>","text":"Type <code>string</code> Required Yes <p>Description: Ceph pool name the vms disk will be created in.</p>"},{"location":"schemas/qemu_inv_schema/#46-property-vm-inventory-tcp_proxies","title":"46. Property <code>VM Inventory &gt; tcp_proxies</code>","text":"Type <code>array of object</code> Required No <p>Description: Raw tcp forwards on the clusters haproxy to k8s services exposed via nodeport.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description tcp_proxies items -"},{"location":"schemas/qemu_inv_schema/#461-vm-inventory-tcp_proxies-tcp_proxies-items","title":"46.1. VM Inventory &gt; tcp_proxies &gt; tcp_proxies items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + proxy_name No string No - Simple name for the forward. Will be rendered in haproxy configuration so it shouldnt contain special characters. + haproxy_port No number No - Frontend port of the proxmox clusters haproxy. + node_port No number No - Nodeport of the k8s service. - proxy_snippet No string No - Additional snippet that will be inserted into the haproxy listen block. Can be used to adjust the forwards settings. - external No boolean No - Will also create a forward on the external floating ip of the proxy not only the internal."},{"location":"schemas/qemu_inv_schema/#4611-property-vm-inventory-tcp_proxies-tcp_proxies-items-proxy_name","title":"46.1.1. Property <code>VM Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; proxy_name</code>","text":"Type <code>string</code> Required Yes <p>Description: Simple name for the forward. Will be rendered in haproxy configuration so it shouldnt contain special characters.</p> <p>Examples:</p> <pre><code>\"gitlab-ssh\"\n</code></pre> <pre><code>\"example-postgres\"\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#4612-property-vm-inventory-tcp_proxies-tcp_proxies-items-haproxy_port","title":"46.1.2. Property <code>VM Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; haproxy_port</code>","text":"Type <code>number</code> Required Yes <p>Description: Frontend port of the proxmox clusters haproxy.</p>"},{"location":"schemas/qemu_inv_schema/#4613-property-vm-inventory-tcp_proxies-tcp_proxies-items-node_port","title":"46.1.3. Property <code>VM Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; node_port</code>","text":"Type <code>number</code> Required Yes <p>Description: Nodeport of the k8s service.</p>"},{"location":"schemas/qemu_inv_schema/#4614-property-vm-inventory-tcp_proxies-tcp_proxies-items-proxy_snippet","title":"46.1.4. Property <code>VM Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; proxy_snippet</code>","text":"Type <code>string</code> Required No <p>Description: Additional snippet that will be inserted into the haproxy listen block. Can be used to adjust the forwards settings.</p> <p>Example:</p> <pre><code>\"# long running tcp connections that only rarely transmit data\\n# ssh client connection for example\\ntimeout client 1h \\ntimeout server 1h \\n\"\n</code></pre>"},{"location":"schemas/qemu_inv_schema/#4615-property-vm-inventory-tcp_proxies-tcp_proxies-items-external","title":"46.1.5. Property <code>VM Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; external</code>","text":"Type <code>boolean</code> Required No <p>Description: Will also create a forward on the external floating ip of the proxy not only the internal.</p>"},{"location":"schemas/qemu_inv_schema/#47-property-vm-inventory-qemu_default_user","title":"47. Property <code>VM Inventory &gt; qemu_default_user</code>","text":"Type <code>string</code> Required No <p>Description: User for cinit.</p>"},{"location":"schemas/qemu_inv_schema/#48-property-vm-inventory-qemu_hashed_pw","title":"48. Property <code>VM Inventory &gt; qemu_hashed_pw</code>","text":"Type <code>string</code> Required No <p>Description: Pw for default user defaults to hashed 'password' for debian cloud init image. Different cloud init images require different hash methods. You cannot use the same from debian for ubuntu for example.</p>"},{"location":"schemas/qemu_inv_schema/#49-property-vm-inventory-qemu_base_parameters","title":"49. Property <code>VM Inventory &gt; qemu_base_parameters</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Base parameters applied to all qemus. passed to the proxmox qm cli tool for creating vm.</p>"},{"location":"schemas/qemu_inv_schema/#50-property-vm-inventory-qemu_image_url","title":"50. Property <code>VM Inventory &gt; qemu_image_url</code>","text":"Type <code>string</code> Required No <p>Description: http(s) download link for cloud init image.</p>"},{"location":"schemas/qemu_inv_schema/#51-property-vm-inventory-qemu_keyboard_layout","title":"51. Property <code>VM Inventory &gt; qemu_keyboard_layout</code>","text":"Type <code>string</code> Required No <p>Description: Keyboard layout for cloudinit.</p>"},{"location":"schemas/qemu_inv_schema/#52-property-vm-inventory-qemu_network_config","title":"52. Property <code>VM Inventory &gt; qemu_network_config</code>","text":"Type <code>string</code> Required No <p>Description: Optional qemu network config as a yaml string that is merged into the cloudinit network config of all qemus.</p>"},{"location":"schemas/qemu_inv_schema/#53-property-vm-inventory-qemu_global_vars","title":"53. Property <code>VM Inventory &gt; qemu_global_vars</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Variables that will be applied set for all qemus vms.</p>"},{"location":"schemas/qemu_inv_schema/#54-property-vm-inventory-plugin","title":"54. Property <code>VM Inventory &gt; plugin</code>","text":"Type <code>enum (of string)</code> Required No <p>Description: Id of ansible inventory plugin</p> <p>Must be one of:</p> <ul> <li>\"pxc.cloud.qemu_inv\"</li> </ul>"},{"location":"schemas/qemu_inv_schema/#55-property-vm-inventory-ingress_domains","title":"55. Property <code>VM Inventory &gt; ingress_domains</code>","text":"Type <code>array of object</code> Required No <p>Description: Specific non ingress routing, via hostname lookup inside the proxy. This allows easy integration of  standalone services like mailcow or other standalone deployments that do their own ingress termination.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description ingress_domains items -"},{"location":"schemas/qemu_inv_schema/#551-vm-inventory-ingress_domains-ingress_domains-items","title":"55.1. VM Inventory &gt; ingress_domains &gt; ingress_domains items","text":"Type <code>object</code> Required No Additional properties Any type allowed Property Pattern Type Deprecated Definition Title/Description - zone No string No - Internal zone that is registered in bind. In this case the playbooks will make records in bindpointing to the vms of the stack. - names No array of string No - Names of the zone that will be routed to vms of this stack. - external No boolean No - Whether or not the routing will also bind to the external floating ip of our haproxy."},{"location":"schemas/qemu_inv_schema/#5511-property-vm-inventory-ingress_domains-ingress_domains-items-zone","title":"55.1.1. Property <code>VM Inventory &gt; ingress_domains &gt; ingress_domains items &gt; zone</code>","text":"Type <code>string</code> Required No <p>Description: Internal zone that is registered in bind. In this case the playbooks will make records in bind pointing to the vms of the stack.</p>"},{"location":"schemas/qemu_inv_schema/#5512-property-vm-inventory-ingress_domains-ingress_domains-items-names","title":"55.1.2. Property <code>VM Inventory &gt; ingress_domains &gt; ingress_domains items &gt; names</code>","text":"Type <code>array of string</code> Required No <p>Description: Names of the zone that will be routed to vms of this stack.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description names items -"},{"location":"schemas/qemu_inv_schema/#55121-vm-inventory-ingress_domains-ingress_domains-items-names-names-items","title":"55.1.2.1. VM Inventory &gt; ingress_domains &gt; ingress_domains items &gt; names &gt; names items","text":"Type <code>string</code> Required No"},{"location":"schemas/qemu_inv_schema/#5513-property-vm-inventory-ingress_domains-ingress_domains-items-external","title":"55.1.3. Property <code>VM Inventory &gt; ingress_domains &gt; ingress_domains items &gt; external</code>","text":"Type <code>boolean</code> Required No <p>Description: Whether or not the routing will also bind to the external floating ip of our haproxy.</p>"},{"location":"schemas/qemu_schema_base/","title":"Qemu schema base","text":"<p>Title: VM Base Inventory</p> Type <code>object</code> Required No Additional properties Not allowed <p>Description: Base inventory that gets inherited by qemu standalone and kubespray nodes.</p> Property Pattern Type Deprecated Definition Title/Description + target_pve No string No - Proxmox cluster name + . + pve cloud domain. This determines the cloud and the proxmox cluster the vms/lxc/k8s luster will be created in. + stack_name No string No - Your stack name, needs to be unique within the cloud domain. - static_includes No object No - For virtual machines we have the option to define tcp_proxies and ingress_domains. If those are set we need certain static includes. - include_stacks No array of object No - Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks. + root_ssh_pub_key No string No - trusted root key for the cloud init image. - pve_ha_group No string No - PVE HA group this vm should be assigned to (optional). - target_pve_hosts No array of string No - Array of proxmox hosts in the target pve that are eligible for scheduling. If not specified all online hosts are considered. + qemus No array of object No - List of qemu vms for the stack. - tcp_proxies No array of object No - Raw tcp forwards on the clusters haproxy to k8s services exposed via nodeport. - qemu_default_user No string No - User for cinit. - qemu_hashed_pw No string No - Pw for default user defaults to hashed 'password' for debian cloud init image. Different cloud init images require different hash methods. You cannot use the same from debian for ubuntu for example. - qemu_base_parameters No object No - Base parameters applied to all qemus. passed to the proxmox qm cli tool for creating vm. - qemu_image_url No string No - http(s) download link for cloud init image. - qemu_keyboard_layout No string No - Keyboard layout for cloudinit. - qemu_network_config No string No - Optional qemu network config as a yaml string that is merged into the cloudinit network config of all qemus. - qemu_global_vars No object No - Variables that will be applied set for all qemus vms. - plugin No enum (of string) No - Id of ansible inventory plugin"},{"location":"schemas/qemu_schema_base/#18-property-vm-base-inventory-target_pve","title":"18. Property <code>VM Base Inventory &gt; target_pve</code>","text":"Type <code>string</code> Required Yes <p>Description: Proxmox cluster name + . + pve cloud domain. This determines the cloud and the proxmox cluster the vms/lxc/k8s luster will be created in.</p> <p>Example:</p> <pre><code>\"proxmox-cluster-a.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_schema_base/#19-property-vm-base-inventory-stack_name","title":"19. Property <code>VM Base Inventory &gt; stack_name</code>","text":"Type <code>string</code> Required Yes <p>Description: Your stack name, needs to be unique within the cloud domain.</p>"},{"location":"schemas/qemu_schema_base/#20-property-vm-base-inventory-static_includes","title":"20. Property <code>VM Base Inventory &gt; static_includes</code>","text":"Type <code>object</code> Required No Additional properties Not allowed <p>Description: For virtual machines we have the option to define tcp_proxies and ingress_domains. If those are set we need certain static includes.</p> Property Pattern Type Deprecated Definition Title/Description - dhcp_stack No string No - For interacting with kea reservations. - proxy_stack No string No - Reloading the proxy. - postgres_stack No string No - The playbook needs the pve cloud postgres stack where state and general configuration is stored. - bind_stack No string No - The playbook needs the bind stack to register the general masters recordset and for creating authoritative zones defined in cluster_cert_entries."},{"location":"schemas/qemu_schema_base/#201-property-vm-base-inventory-static_includes-dhcp_stack","title":"20.1. Property <code>VM Base Inventory &gt; static_includes &gt; dhcp_stack</code>","text":"Type <code>string</code> Required No <p>Description: For interacting with kea reservations.</p> <p>Example:</p> <pre><code>\"dhcp.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_schema_base/#202-property-vm-base-inventory-static_includes-proxy_stack","title":"20.2. Property <code>VM Base Inventory &gt; static_includes &gt; proxy_stack</code>","text":"Type <code>string</code> Required No <p>Description: Reloading the proxy.</p> <p>Example:</p> <pre><code>\"proxy.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_schema_base/#203-property-vm-base-inventory-static_includes-postgres_stack","title":"20.3. Property <code>VM Base Inventory &gt; static_includes &gt; postgres_stack</code>","text":"Type <code>string</code> Required No <p>Description: The playbook needs the pve cloud postgres stack where state and general configuration is stored.</p> <p>Example:</p> <pre><code>\"patroni.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_schema_base/#204-property-vm-base-inventory-static_includes-bind_stack","title":"20.4. Property <code>VM Base Inventory &gt; static_includes &gt; bind_stack</code>","text":"Type <code>string</code> Required No <p>Description: The playbook needs the bind stack to register the general masters recordset and for creating authoritative zones defined in cluster_cert_entries.</p> <p>Example:</p> <pre><code>\"bind.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_schema_base/#21-property-vm-base-inventory-include_stacks","title":"21. Property <code>VM Base Inventory &gt; include_stacks</code>","text":"Type <code>array of object</code> Required No <p>Description: Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description include_stacks items -"},{"location":"schemas/qemu_schema_base/#211-vm-base-inventory-include_stacks-include_stacks-items","title":"21.1. VM Base Inventory &gt; include_stacks &gt; include_stacks items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + stack_fqdn No string No - Target stack fqdn to include (stack name + pve_cloud_domain). Will automatically include it from the right pve cluster. + host_group No string No - This is the name of the hosts group of our ansible inventory the included vms/lxcs will be available under. - qemu_ansible_user No string No - User ansible will use to connect, defaults to admin. If you dont want to use debian cinit images you might need to set something else than admin.Ubuntu for example wont work if you set the cloud init user to admin."},{"location":"schemas/qemu_schema_base/#2111-property-vm-base-inventory-include_stacks-include_stacks-items-stack_fqdn","title":"21.1.1. Property <code>VM Base Inventory &gt; include_stacks &gt; include_stacks items &gt; stack_fqdn</code>","text":"Type <code>string</code> Required Yes <p>Description: Target stack fqdn to include (stack name + pve_cloud_domain). Will automatically include it from the right pve cluster.</p> <p>Examples:</p> <pre><code>\"bind.your-other-cloud.domain\"\n</code></pre> <pre><code>\"other-k8s.your-other-cloud.domain\"\n</code></pre>"},{"location":"schemas/qemu_schema_base/#2112-property-vm-base-inventory-include_stacks-include_stacks-items-host_group","title":"21.1.2. Property <code>VM Base Inventory &gt; include_stacks &gt; include_stacks items &gt; host_group</code>","text":"Type <code>string</code> Required Yes <p>Description: This is the name of the hosts group of our ansible inventory the included vms/lxcs will be available under.</p>"},{"location":"schemas/qemu_schema_base/#2113-property-vm-base-inventory-include_stacks-include_stacks-items-qemu_ansible_user","title":"21.1.3. Property <code>VM Base Inventory &gt; include_stacks &gt; include_stacks items &gt; qemu_ansible_user</code>","text":"Type <code>string</code> Required No <p>Description: User ansible will use to connect, defaults to admin. If you dont want to use debian cinit images you might need to set something else than admin. Ubuntu for example wont work if you set the cloud init user to admin.</p>"},{"location":"schemas/qemu_schema_base/#22-property-vm-base-inventory-root_ssh_pub_key","title":"22. Property <code>VM Base Inventory &gt; root_ssh_pub_key</code>","text":"Type <code>string</code> Required Yes <p>Description: trusted root key for the cloud init image.</p>"},{"location":"schemas/qemu_schema_base/#23-property-vm-base-inventory-pve_ha_group","title":"23. Property <code>VM Base Inventory &gt; pve_ha_group</code>","text":"Type <code>string</code> Required No <p>Description: PVE HA group this vm should be assigned to (optional).</p>"},{"location":"schemas/qemu_schema_base/#24-property-vm-base-inventory-target_pve_hosts","title":"24. Property <code>VM Base Inventory &gt; target_pve_hosts</code>","text":"Type <code>array of string</code> Required No <p>Description: Array of proxmox hosts in the target pve that are eligible for scheduling. If not specified all online hosts are considered.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description target_pve_hosts items The hostname of the proxmox host. Just the hostname, no cluster name or cloud domain should be specified, as they are implicit."},{"location":"schemas/qemu_schema_base/#241-vm-base-inventory-target_pve_hosts-target_pve_hosts-items","title":"24.1. VM Base Inventory &gt; target_pve_hosts &gt; target_pve_hosts items","text":"Type <code>string</code> Required No <p>Description: The hostname of the proxmox host. Just the hostname, no cluster name or cloud domain should be specified, as they are implicit.</p> <p>Example:</p> <pre><code>\"proxmox-host-a\"\n</code></pre>"},{"location":"schemas/qemu_schema_base/#25-property-vm-base-inventory-qemus","title":"25. Property <code>VM Base Inventory &gt; qemus</code>","text":"Type <code>array of object</code> Required Yes <p>Description: List of qemu vms for the stack.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description qemus items -"},{"location":"schemas/qemu_schema_base/#251-vm-base-inventory-qemus-qemus-items","title":"25.1. VM Base Inventory &gt; qemus &gt; qemus items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description - hostname No string No - Optional unique hostname for this node, otherwise pet name random name will be generated. - vars No object No - Custom variables for this node specifically, might be useful in your own custom playbooks. - target_host No string No - Optional specific proxmox host you want to tie this node to on creation. Can of course still be moved afterwards. Cloud domain is implicit and should not be specified. + parameters No object No - In accordance with pve qm cli tool, creation parameters mapped (key equals the --key part and value the passed value). - network_config No string No - Cinit network config yaml string. Will be the last cfg piece that gets merged into the final cloudinit network config. Can be used for overrides. + disk No object No - -"},{"location":"schemas/qemu_schema_base/#2511-property-vm-base-inventory-qemus-qemus-items-hostname","title":"25.1.1. Property <code>VM Base Inventory &gt; qemus &gt; qemus items &gt; hostname</code>","text":"Type <code>string</code> Required No <p>Description: Optional unique hostname for this node, otherwise pet name random name will be generated.</p>"},{"location":"schemas/qemu_schema_base/#2512-property-vm-base-inventory-qemus-qemus-items-vars","title":"25.1.2. Property <code>VM Base Inventory &gt; qemus &gt; qemus items &gt; vars</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Custom variables for this node specifically, might be useful in your own custom playbooks.</p>"},{"location":"schemas/qemu_schema_base/#2513-property-vm-base-inventory-qemus-qemus-items-target_host","title":"25.1.3. Property <code>VM Base Inventory &gt; qemus &gt; qemus items &gt; target_host</code>","text":"Type <code>string</code> Required No <p>Description: Optional specific proxmox host you want to tie this node to on creation. Can of course still be moved afterwards. Cloud domain is implicit and should not be specified.</p> <p>Example:</p> <pre><code>\"proxmox-host-B.proxmox-cluster-A\"\n</code></pre>"},{"location":"schemas/qemu_schema_base/#2514-property-vm-base-inventory-qemus-qemus-items-parameters","title":"25.1.4. Property <code>VM Base Inventory &gt; qemus &gt; qemus items &gt; parameters</code>","text":"Type <code>object</code> Required Yes Additional properties Any type allowed <p>Description: In accordance with pve qm cli tool, creation parameters mapped (key equals the --key part and value the passed value).</p> <p>Example:</p> <pre><code>{\n    \"cores\": 1,\n    \"memory\": 1024\n}\n</code></pre>"},{"location":"schemas/qemu_schema_base/#2515-property-vm-base-inventory-qemus-qemus-items-network_config","title":"25.1.5. Property <code>VM Base Inventory &gt; qemus &gt; qemus items &gt; network_config</code>","text":"Type <code>string</code> Required No <p>Description: Cinit network config yaml string. Will be the last cfg piece that gets merged into the final cloudinit network config. Can be used for overrides.</p>"},{"location":"schemas/qemu_schema_base/#2516-property-vm-base-inventory-qemus-qemus-items-disk","title":"25.1.6. Property <code>VM Base Inventory &gt; qemus &gt; qemus items &gt; disk</code>","text":"Type <code>object</code> Required Yes Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + size No string No - Size of the vms disk. - options No object No - Mount options + pool No string No - Ceph pool name the vms disk will be created in."},{"location":"schemas/qemu_schema_base/#25161-property-vm-base-inventory-qemus-qemus-items-disk-size","title":"25.1.6.1. Property <code>VM Base Inventory &gt; qemus &gt; qemus items &gt; disk &gt; size</code>","text":"Type <code>string</code> Required Yes <p>Description: Size of the vms disk.</p> <p>Example:</p> <pre><code>\"25G\"\n</code></pre>"},{"location":"schemas/qemu_schema_base/#25162-property-vm-base-inventory-qemus-qemus-items-disk-options","title":"25.1.6.2. Property <code>VM Base Inventory &gt; qemus &gt; qemus items &gt; disk &gt; options</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Mount options</p>"},{"location":"schemas/qemu_schema_base/#25163-property-vm-base-inventory-qemus-qemus-items-disk-pool","title":"25.1.6.3. Property <code>VM Base Inventory &gt; qemus &gt; qemus items &gt; disk &gt; pool</code>","text":"Type <code>string</code> Required Yes <p>Description: Ceph pool name the vms disk will be created in.</p>"},{"location":"schemas/qemu_schema_base/#26-property-vm-base-inventory-tcp_proxies","title":"26. Property <code>VM Base Inventory &gt; tcp_proxies</code>","text":"Type <code>array of object</code> Required No <p>Description: Raw tcp forwards on the clusters haproxy to k8s services exposed via nodeport.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description tcp_proxies items -"},{"location":"schemas/qemu_schema_base/#261-vm-base-inventory-tcp_proxies-tcp_proxies-items","title":"26.1. VM Base Inventory &gt; tcp_proxies &gt; tcp_proxies items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + proxy_name No string No - Simple name for the forward. Will be rendered in haproxy configuration so it shouldnt contain special characters. + haproxy_port No number No - Frontend port of the proxmox clusters haproxy. + node_port No number No - Nodeport of the k8s service. - proxy_snippet No string No - Additional snippet that will be inserted into the haproxy listen block. Can be used to adjust the forwards settings. - external No boolean No - Will also create a forward on the external floating ip of the proxy not only the internal."},{"location":"schemas/qemu_schema_base/#2611-property-vm-base-inventory-tcp_proxies-tcp_proxies-items-proxy_name","title":"26.1.1. Property <code>VM Base Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; proxy_name</code>","text":"Type <code>string</code> Required Yes <p>Description: Simple name for the forward. Will be rendered in haproxy configuration so it shouldnt contain special characters.</p> <p>Examples:</p> <pre><code>\"gitlab-ssh\"\n</code></pre> <pre><code>\"example-postgres\"\n</code></pre>"},{"location":"schemas/qemu_schema_base/#2612-property-vm-base-inventory-tcp_proxies-tcp_proxies-items-haproxy_port","title":"26.1.2. Property <code>VM Base Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; haproxy_port</code>","text":"Type <code>number</code> Required Yes <p>Description: Frontend port of the proxmox clusters haproxy.</p>"},{"location":"schemas/qemu_schema_base/#2613-property-vm-base-inventory-tcp_proxies-tcp_proxies-items-node_port","title":"26.1.3. Property <code>VM Base Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; node_port</code>","text":"Type <code>number</code> Required Yes <p>Description: Nodeport of the k8s service.</p>"},{"location":"schemas/qemu_schema_base/#2614-property-vm-base-inventory-tcp_proxies-tcp_proxies-items-proxy_snippet","title":"26.1.4. Property <code>VM Base Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; proxy_snippet</code>","text":"Type <code>string</code> Required No <p>Description: Additional snippet that will be inserted into the haproxy listen block. Can be used to adjust the forwards settings.</p> <p>Example:</p> <pre><code>\"# long running tcp connections that only rarely transmit data\\n# ssh client connection for example\\ntimeout client 1h \\ntimeout server 1h \\n\"\n</code></pre>"},{"location":"schemas/qemu_schema_base/#2615-property-vm-base-inventory-tcp_proxies-tcp_proxies-items-external","title":"26.1.5. Property <code>VM Base Inventory &gt; tcp_proxies &gt; tcp_proxies items &gt; external</code>","text":"Type <code>boolean</code> Required No <p>Description: Will also create a forward on the external floating ip of the proxy not only the internal.</p>"},{"location":"schemas/qemu_schema_base/#27-property-vm-base-inventory-qemu_default_user","title":"27. Property <code>VM Base Inventory &gt; qemu_default_user</code>","text":"Type <code>string</code> Required No <p>Description: User for cinit.</p>"},{"location":"schemas/qemu_schema_base/#28-property-vm-base-inventory-qemu_hashed_pw","title":"28. Property <code>VM Base Inventory &gt; qemu_hashed_pw</code>","text":"Type <code>string</code> Required No <p>Description: Pw for default user defaults to hashed 'password' for debian cloud init image. Different cloud init images require different hash methods. You cannot use the same from debian for ubuntu for example.</p>"},{"location":"schemas/qemu_schema_base/#29-property-vm-base-inventory-qemu_base_parameters","title":"29. Property <code>VM Base Inventory &gt; qemu_base_parameters</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Base parameters applied to all qemus. passed to the proxmox qm cli tool for creating vm.</p>"},{"location":"schemas/qemu_schema_base/#30-property-vm-base-inventory-qemu_image_url","title":"30. Property <code>VM Base Inventory &gt; qemu_image_url</code>","text":"Type <code>string</code> Required No <p>Description: http(s) download link for cloud init image.</p>"},{"location":"schemas/qemu_schema_base/#31-property-vm-base-inventory-qemu_keyboard_layout","title":"31. Property <code>VM Base Inventory &gt; qemu_keyboard_layout</code>","text":"Type <code>string</code> Required No <p>Description: Keyboard layout for cloudinit.</p>"},{"location":"schemas/qemu_schema_base/#32-property-vm-base-inventory-qemu_network_config","title":"32. Property <code>VM Base Inventory &gt; qemu_network_config</code>","text":"Type <code>string</code> Required No <p>Description: Optional qemu network config as a yaml string that is merged into the cloudinit network config of all qemus.</p>"},{"location":"schemas/qemu_schema_base/#33-property-vm-base-inventory-qemu_global_vars","title":"33. Property <code>VM Base Inventory &gt; qemu_global_vars</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Variables that will be applied set for all qemus vms.</p>"},{"location":"schemas/qemu_schema_base/#34-property-vm-base-inventory-plugin","title":"34. Property <code>VM Base Inventory &gt; plugin</code>","text":"Type <code>enum (of string)</code> Required No <p>Description: Id of ansible inventory plugin</p> <p>Must be one of:</p> <ul> <li>\"pxc.cloud.qemu_inv\"</li> </ul>"},{"location":"schemas/setup_bind_schema_ext/","title":"Setup bind schema ext","text":"<p>Title: Bind Dns Inventory</p> Type <code>object</code> Required No Additional properties Any type allowed <p>Description: LXC Inventory extension for the setup_bind playbook. This extends the LXC Inventory schema.</p> Property Pattern Type Deprecated Definition Title/Description - lxcs No array of object No - List of lxcs that will be created for the stack."},{"location":"schemas/setup_bind_schema_ext/#35-property-bind-dns-inventory-lxcs","title":"35. Property <code>Bind Dns Inventory &gt; lxcs</code>","text":"Type <code>array of object</code> Required No <p>Description: List of lxcs that will be created for the stack.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description lxcs items -"},{"location":"schemas/setup_bind_schema_ext/#351-bind-dns-inventory-lxcs-lxcs-items","title":"35.1. Bind Dns Inventory &gt; lxcs &gt; lxcs items","text":"Type <code>object</code> Required No Additional properties Any type allowed Property Pattern Type Deprecated Definition Title/Description + vars No object No - For the dns to work we need to tell the playbooks which lxc will serve as the master and which as the slave."},{"location":"schemas/setup_bind_schema_ext/#3511-property-bind-dns-inventory-lxcs-lxcs-items-vars","title":"35.1.1. Property <code>Bind Dns Inventory &gt; lxcs &gt; lxcs items &gt; vars</code>","text":"Type <code>object</code> Required Yes Additional properties Any type allowed <p>Description: For the dns to work we need to tell the playbooks which lxc will serve as the master and which as the slave.</p> Property Pattern Type Deprecated Definition Title/Description + bind_master No boolean No - The default pve cloud configured dns uses only a master slave combination. You should create two lxcs,one that has this flag set to true, the other to false."},{"location":"schemas/setup_bind_schema_ext/#35111-property-bind-dns-inventory-lxcs-lxcs-items-vars-bind_master","title":"35.1.1.1. Property <code>Bind Dns Inventory &gt; lxcs &gt; lxcs items &gt; vars &gt; bind_master</code>","text":"Type <code>boolean</code> Required Yes <p>Description: The default pve cloud configured dns uses only a master slave combination. You should create two lxcs, one that has this flag set to true, the other to false.</p>"},{"location":"schemas/setup_ceph_kea_schema_ext/","title":"Setup ceph kea schema ext","text":"<p>Title: Ceph DHCP Inventory</p> Type <code>object</code> Required No Additional properties Any type allowed <p>Description: LXC Inventory extension for the setup_ceph_kea playbook. This extends the LXC Inventory schema.</p> Property Pattern Type Deprecated Definition Title/Description - lxcs No array of object No - List of lxcs that will be created for the stack."},{"location":"schemas/setup_ceph_kea_schema_ext/#37-property-ceph-dhcp-inventory-lxcs","title":"37. Property <code>Ceph DHCP Inventory &gt; lxcs</code>","text":"Type <code>array of object</code> Required No <p>Description: List of lxcs that will be created for the stack.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description lxcs items -"},{"location":"schemas/setup_ceph_kea_schema_ext/#371-ceph-dhcp-inventory-lxcs-lxcs-items","title":"37.1. Ceph DHCP Inventory &gt; lxcs &gt; lxcs items","text":"Type <code>object</code> Required No Additional properties Any type allowed Property Pattern Type Deprecated Definition Title/Description - parameters No object No - Besides the default lxc parameters you have to define the network interfaces with a certain pattern. + vars No object No - The standalone ceph dhcp needs to know pool and subnet for assigning ips."},{"location":"schemas/setup_ceph_kea_schema_ext/#3711-property-ceph-dhcp-inventory-lxcs-lxcs-items-parameters","title":"37.1.1. Property <code>Ceph DHCP Inventory &gt; lxcs &gt; lxcs items &gt; parameters</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Besides the default lxc parameters you have to define the network interfaces with a certain pattern.</p> Property Pattern Type Deprecated Definition Title/Description - net1 No object No - This dhcp is exclusively for use with a seperate network for ceph frontend communication.Ceph monitors are usually static and kubernetes nodes that use the csi driver need tobe able to communicate them. The interface needs to be named \"cephfe\" as this is how thekea dhcp config is written."},{"location":"schemas/setup_ceph_kea_schema_ext/#37111-property-ceph-dhcp-inventory-lxcs-lxcs-items-parameters-net1","title":"37.1.1.1. Property <code>Ceph DHCP Inventory &gt; lxcs &gt; lxcs items &gt; parameters &gt; net1</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: This dhcp is exclusively for use with a seperate network for ceph frontend communication. Ceph monitors are usually static and kubernetes nodes that use the csi driver need to be able to communicate them. The interface needs to be named \"cephfe\" as this is how the kea dhcp config is written.</p> Restrictions Must match regular expression <code>\\bname=cephfe\\b</code> Test"},{"location":"schemas/setup_ceph_kea_schema_ext/#3712-property-ceph-dhcp-inventory-lxcs-lxcs-items-vars","title":"37.1.2. Property <code>Ceph DHCP Inventory &gt; lxcs &gt; lxcs items &gt; vars</code>","text":"Type <code>object</code> Required Yes Additional properties Any type allowed <p>Description: The standalone ceph dhcp needs to know pool and subnet for assigning ips.</p> Property Pattern Type Deprecated Definition Title/Description + kea_dhcp_ceph_frontend_subnet No string No - Optional definition for a seperate dhcp if the ceph frontend resides on a different interface (map it inside the dhcp lxcs to pve0). + kea_dhcp_ceph_frontend_pool No string No - Pool for ceph frontend ip allocations, this way monitors can have their static block."},{"location":"schemas/setup_ceph_kea_schema_ext/#37121-property-ceph-dhcp-inventory-lxcs-lxcs-items-vars-kea_dhcp_ceph_frontend_subnet","title":"37.1.2.1. Property <code>Ceph DHCP Inventory &gt; lxcs &gt; lxcs items &gt; vars &gt; kea_dhcp_ceph_frontend_subnet</code>","text":"Type <code>string</code> Required Yes <p>Description: Optional definition for a seperate dhcp if the ceph frontend resides on a different interface (map it inside the dhcp lxcs to pve0).</p> <p>Example:</p> <pre><code>\"10.0.255.0/24\"\n</code></pre>"},{"location":"schemas/setup_ceph_kea_schema_ext/#37122-property-ceph-dhcp-inventory-lxcs-lxcs-items-vars-kea_dhcp_ceph_frontend_pool","title":"37.1.2.2. Property <code>Ceph DHCP Inventory &gt; lxcs &gt; lxcs items &gt; vars &gt; kea_dhcp_ceph_frontend_pool</code>","text":"Type <code>string</code> Required Yes <p>Description: Pool for ceph frontend ip allocations, this way monitors can have their static block.</p> <p>Example:</p> <pre><code>\"10.0.255.40 - 10.0.255.254\"\n</code></pre>"},{"location":"schemas/setup_haproxy_schema_ext/","title":"Setup haproxy schema ext","text":"<p>Title: HAProxy Inventory</p> Type <code>object</code> Required No Additional properties Any type allowed <p>Description: LXC Inventory extension for the setup_proxy playbook. This extends the LXC Inventory schema.</p> Property Pattern Type Deprecated Definition Title/Description + static_includes No object No - Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks. - lxcs No array No - List of lxcs that will be created for the stack."},{"location":"schemas/setup_haproxy_schema_ext/#75-property-haproxy-inventory-static_includes","title":"75. Property <code>HAProxy Inventory &gt; static_includes</code>","text":"Type <code>object</code> Required Yes Additional properties Not allowed <p>Description: Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks.</p> Property Pattern Type Deprecated Definition Title/Description + postgres_stack No string No - Stack fqdn for postgres patroni stack. On the presence of the host the playbook will fetchproxy configuration from the database. This is needed so that after the initial setup everythingstill works."},{"location":"schemas/setup_haproxy_schema_ext/#751-property-haproxy-inventory-static_includes-postgres_stack","title":"75.1. Property <code>HAProxy Inventory &gt; static_includes &gt; postgres_stack</code>","text":"Type <code>string</code> Required Yes <p>Description: Stack fqdn for postgres patroni stack. On the presence of the host the playbook will fetch proxy configuration from the database. This is needed so that after the initial setup everything still works.</p> <p>Example:</p> <pre><code>\"patroni.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/setup_haproxy_schema_ext/#76-property-haproxy-inventory-lxcs","title":"76. Property <code>HAProxy Inventory &gt; lxcs</code>","text":"Type <code>array</code> Required No <p>Description: List of lxcs that will be created for the stack.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description lxcs items -"},{"location":"schemas/setup_haproxy_schema_ext/#761-haproxy-inventory-lxcs-lxcs-items","title":"76.1. HAProxy Inventory &gt; lxcs &gt; lxcs items","text":"Type <code>object</code> Required No Additional properties Any type allowed Property Pattern Type Deprecated Definition Title/Description + vars No object No - Our proxy stack needs to know which lxc is the keepalived master and who is the failover."},{"location":"schemas/setup_haproxy_schema_ext/#7611-property-haproxy-inventory-lxcs-lxcs-items-vars","title":"76.1.1. Property <code>HAProxy Inventory &gt; lxcs &gt; lxcs items &gt; vars</code>","text":"Type <code>object</code> Required Yes Additional properties Any type allowed <p>Description: Our proxy stack needs to know which lxc is the keepalived master and who is the failover.</p> Property Pattern Type Deprecated Definition Title/Description + keepalived_master No boolean No - One LXC should have this set to true the other to false."},{"location":"schemas/setup_haproxy_schema_ext/#76111-property-haproxy-inventory-lxcs-lxcs-items-vars-keepalived_master","title":"76.1.1.1. Property <code>HAProxy Inventory &gt; lxcs &gt; lxcs items &gt; vars &gt; keepalived_master</code>","text":"Type <code>boolean</code> Required Yes <p>Description: One LXC should have this set to true the other to false.</p>"},{"location":"schemas/setup_kea_schema_ext/","title":"Setup kea schema ext","text":"<p>Title: General DHCP Inventory</p> Type <code>object</code> Required No Additional properties Any type allowed <p>Description: LXC Inventory extension for the setup_kea playbook. This extends the LXC Inventory schema.</p> Property Pattern Type Deprecated Definition Title/Description - lxcs No array of object No - List of lxcs that will be created for the stack."},{"location":"schemas/setup_kea_schema_ext/#36-property-general-dhcp-inventory-lxcs","title":"36. Property <code>General DHCP Inventory &gt; lxcs</code>","text":"Type <code>array of object</code> Required No <p>Description: List of lxcs that will be created for the stack.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description lxcs items -"},{"location":"schemas/setup_kea_schema_ext/#361-general-dhcp-inventory-lxcs-lxcs-items","title":"36.1. General DHCP Inventory &gt; lxcs &gt; lxcs items","text":"Type <code>object</code> Required No Additional properties Any type allowed Property Pattern Type Deprecated Definition Title/Description - parameters No object No - Besides the default lxc parameters you have to define the network interfaces with a certain pattern. + vars No object No - For the dhcp to work we need to tell the playbooks which lxc will serve as the main and which as the failover."},{"location":"schemas/setup_kea_schema_ext/#3611-property-general-dhcp-inventory-lxcs-lxcs-items-parameters","title":"36.1.1. Property <code>General DHCP Inventory &gt; lxcs &gt; lxcs items &gt; parameters</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Besides the default lxc parameters you have to define the network interfaces with a certain pattern.</p> Property Pattern Type Deprecated Definition Title/Description - net0 No object No - Network interface the dhcp will serve on. This has to be named \"pve\" instead of the normal eth0 for the dhcp playbooks to work,they configure kea to listen on this interface name."},{"location":"schemas/setup_kea_schema_ext/#36111-property-general-dhcp-inventory-lxcs-lxcs-items-parameters-net0","title":"36.1.1.1. Property <code>General DHCP Inventory &gt; lxcs &gt; lxcs items &gt; parameters &gt; net0</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: Network interface the dhcp will serve on. This has to be named \"pve\" instead of the normal eth0 for the dhcp playbooks to work, they configure kea to listen on this interface name.</p> Restrictions Must match regular expression <code>\\bname=pve\\b</code> Test"},{"location":"schemas/setup_kea_schema_ext/#3612-property-general-dhcp-inventory-lxcs-lxcs-items-vars","title":"36.1.2. Property <code>General DHCP Inventory &gt; lxcs &gt; lxcs items &gt; vars</code>","text":"Type <code>object</code> Required Yes Additional properties Any type allowed <p>Description: For the dhcp to work we need to tell the playbooks which lxc will serve as the main and which as the failover.</p> Property Pattern Type Deprecated Definition Title/Description + kea_dhcp_main No boolean No - Determines the lxc that will be the dhcp master instance. One lxc should be set to true, the other to false."},{"location":"schemas/setup_kea_schema_ext/#36121-property-general-dhcp-inventory-lxcs-lxcs-items-vars-kea_dhcp_main","title":"36.1.2.1. Property <code>General DHCP Inventory &gt; lxcs &gt; lxcs items &gt; vars &gt; kea_dhcp_main</code>","text":"Type <code>boolean</code> Required Yes <p>Description: Determines the lxc that will be the dhcp master instance. One lxc should be set to true, the other to false.</p>"},{"location":"schemas/vm_schema_base/","title":"Vm schema base","text":"<p>Title: VM/LXC Base Schema</p> Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + target_pve No string No - Proxmox cluster name + . + pve cloud domain. This determines the cloud and the proxmox cluster the vms/lxc/k8s luster will be created in. + stack_name No string No - Your stack name, needs to be unique within the cloud domain. - static_includes No object No - This property contains specific hosts / stacks that need to be included for a schema extension. This way playbooks can staticallyreference a host group and assume it to be a certain stack (e.g. postgres/haproxy/dhcp). - include_stacks No array of object No - Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks. + root_ssh_pub_key No string No - trusted root key for the cloud init image. - pve_ha_group No string No - PVE HA group this vm should be assigned to (optional). - target_pve_hosts No array of string No - Array of proxmox hosts in the target pve that are eligible for scheduling. If not specified all online hosts are considered."},{"location":"schemas/vm_schema_base/#68-property-vmlxc-base-schema-target_pve","title":"68. Property <code>VM/LXC Base Schema &gt; target_pve</code>","text":"Type <code>string</code> Required Yes <p>Description: Proxmox cluster name + . + pve cloud domain. This determines the cloud and the proxmox cluster the vms/lxc/k8s luster will be created in.</p> <p>Example:</p> <pre><code>\"proxmox-cluster-a.your-cloud.domain\"\n</code></pre>"},{"location":"schemas/vm_schema_base/#69-property-vmlxc-base-schema-stack_name","title":"69. Property <code>VM/LXC Base Schema &gt; stack_name</code>","text":"Type <code>string</code> Required Yes <p>Description: Your stack name, needs to be unique within the cloud domain.</p>"},{"location":"schemas/vm_schema_base/#70-property-vmlxc-base-schema-static_includes","title":"70. Property <code>VM/LXC Base Schema &gt; static_includes</code>","text":"Type <code>object</code> Required No Additional properties Any type allowed <p>Description: This property contains specific hosts / stacks that need to be included for a schema extension. This way playbooks can statically reference a host group and assume it to be a certain stack (e.g. postgres/haproxy/dhcp).</p>"},{"location":"schemas/vm_schema_base/#71-property-vmlxc-base-schema-include_stacks","title":"71. Property <code>VM/LXC Base Schema &gt; include_stacks</code>","text":"Type <code>array of object</code> Required No <p>Description: Include other stacks into the ansible inventory, from any pve cloud you are connected to. From here you can freely extend and write your own playbooks.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description include_stacks items -"},{"location":"schemas/vm_schema_base/#711-vmlxc-base-schema-include_stacks-include_stacks-items","title":"71.1. VM/LXC Base Schema &gt; include_stacks &gt; include_stacks items","text":"Type <code>object</code> Required No Additional properties Not allowed Property Pattern Type Deprecated Definition Title/Description + stack_fqdn No string No - Target stack fqdn to include (stack name + pve_cloud_domain). Will automatically include it from the right pve cluster. + host_group No string No - This is the name of the hosts group of our ansible inventory the included vms/lxcs will be available under. - qemu_ansible_user No string No - User ansible will use to connect, defaults to admin. If you dont want to use debian cinit images you might need to set something else than admin.Ubuntu for example wont work if you set the cloud init user to admin."},{"location":"schemas/vm_schema_base/#7111-property-vmlxc-base-schema-include_stacks-include_stacks-items-stack_fqdn","title":"71.1.1. Property <code>VM/LXC Base Schema &gt; include_stacks &gt; include_stacks items &gt; stack_fqdn</code>","text":"Type <code>string</code> Required Yes <p>Description: Target stack fqdn to include (stack name + pve_cloud_domain). Will automatically include it from the right pve cluster.</p> <p>Examples:</p> <pre><code>\"bind.your-other-cloud.domain\"\n</code></pre> <pre><code>\"other-k8s.your-other-cloud.domain\"\n</code></pre>"},{"location":"schemas/vm_schema_base/#7112-property-vmlxc-base-schema-include_stacks-include_stacks-items-host_group","title":"71.1.2. Property <code>VM/LXC Base Schema &gt; include_stacks &gt; include_stacks items &gt; host_group</code>","text":"Type <code>string</code> Required Yes <p>Description: This is the name of the hosts group of our ansible inventory the included vms/lxcs will be available under.</p>"},{"location":"schemas/vm_schema_base/#7113-property-vmlxc-base-schema-include_stacks-include_stacks-items-qemu_ansible_user","title":"71.1.3. Property <code>VM/LXC Base Schema &gt; include_stacks &gt; include_stacks items &gt; qemu_ansible_user</code>","text":"Type <code>string</code> Required No <p>Description: User ansible will use to connect, defaults to admin. If you dont want to use debian cinit images you might need to set something else than admin. Ubuntu for example wont work if you set the cloud init user to admin.</p>"},{"location":"schemas/vm_schema_base/#72-property-vmlxc-base-schema-root_ssh_pub_key","title":"72. Property <code>VM/LXC Base Schema &gt; root_ssh_pub_key</code>","text":"Type <code>string</code> Required Yes <p>Description: trusted root key for the cloud init image.</p>"},{"location":"schemas/vm_schema_base/#73-property-vmlxc-base-schema-pve_ha_group","title":"73. Property <code>VM/LXC Base Schema &gt; pve_ha_group</code>","text":"Type <code>string</code> Required No <p>Description: PVE HA group this vm should be assigned to (optional).</p>"},{"location":"schemas/vm_schema_base/#74-property-vmlxc-base-schema-target_pve_hosts","title":"74. Property <code>VM/LXC Base Schema &gt; target_pve_hosts</code>","text":"Type <code>array of string</code> Required No <p>Description: Array of proxmox hosts in the target pve that are eligible for scheduling. If not specified all online hosts are considered.</p> Array restrictions Min items N/A Max items N/A Items unicity False Additional items False Tuple validation See below Each item of this array must be Description target_pve_hosts items The hostname of the proxmox host. Just the hostname, no cluster name or cloud domain should be specified, as they are implicit."},{"location":"schemas/vm_schema_base/#741-vmlxc-base-schema-target_pve_hosts-target_pve_hosts-items","title":"74.1. VM/LXC Base Schema &gt; target_pve_hosts &gt; target_pve_hosts items","text":"Type <code>string</code> Required No <p>Description: The hostname of the proxmox host. Just the hostname, no cluster name or cloud domain should be specified, as they are implicit.</p> <p>Example:</p> <pre><code>\"proxmox-host-a\"\n</code></pre>"}]}